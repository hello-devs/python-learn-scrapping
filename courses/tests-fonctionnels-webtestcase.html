<!DOCTYPE html>
<html lang="fr">
 <head>
  <meta http-equiv="x-ua-compatible" content="IE=EDGE">
  <title>Tests fonctionnels avec WebTestCase [Tests fonctionnels avec WebTestCase et Panther]</title>
  <meta charset="UTF-8">
  <meta name="generator" content="SCENARI 4.2.201 / opaleStudi 3.7.064">
  <meta name="revision" content="2021-05-21 13:39">
  <link rel="start" href="module-test-fonctionnel-webtest-panth.html" title="Les tests fonctionnels avec WebTestCase et Panther">
  <meta name="author" content>
  <meta name="keywords" content>
  <meta name="date" content>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="../lib-md/w_scCodeMgr/scCodeMgr.css">
  <link rel="stylesheet" type="text/css" href="../lib-md/w_scImgMgr/scImgMgr.css">
  <script type="text/JavaScript">
/*0*/ var scServices = {id:"koydd1u8"};
/*1*/ window.scLoadParams = {destUri:"/co/tests-fonctionnels-webtestcase.html", pathToRoot:"../"};
</script>
  <script type="text/JavaScript" src="../lib-sc/scCoLib.js"></script>
  <script type="text/JavaScript" src="../lib-sc/scPaLib.js"></script>
  <script type="text/JavaScript" src="../lib-sc/scSiLib.js"></script>
  <script type="text/JavaScript" src="../lib-sc/scTiLib.js"></script>
  <script type="text/JavaScript" src="../lib-sc/scTooltipMgr.js"></script>
  <script type="text/JavaScript" src="../lib-sc/scMapMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/s_assmnt.js"></script>
  <script type="text/JavaScript" src="../lib-sc/scDragMgr.js"></script>
  <script type="text/JavaScript" src="../lib-sc/scDynUiMgr.js"></script>
  <script type="text/JavaScript" src="../lib-sc/scAssmntMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_studiMgr/jquery-1.11.3.min.js"></script>
  <script type="text/JavaScript" src="../lib-md/s_scSearch/scSearch.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_tplMgr/tplMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_mathjax/mathjaxMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_scCodeMgr/scCodeMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_outMgr/outMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_scMediaMgr/scMediaMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_scImgMgr/scImgMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_searchMgr/searchMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_jwplayerMgr/jwplayerMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_studiMgr/studiMgr.js"></script>
  <script type="text/JavaScript">

/*0*/ try{if(window.opener && window.opener.scServices && window.opener.scServices.id == scServices.id) scServices = window.opener.scServices; else if(window.parent && window.parent.scServices && window.parent.scServices.id == scServices.id) scServices = window.parent.scServices;}catch(e){}
scCodeMgr.registerCode("des:div.code");

scImgMgr.registerAdaptedImage("ide:content/des:img");

scImgMgr.registerGallery("des:div.galFra");

scImgMgr.registerSvg("des:svg");
scImgMgr.registerZoom("des:a.svgZoom",{type:"svg",svgMax:1,toolbar:1,titlePath:"par:/nsi:/des:span.capTi"});

scImgMgr.registerZoom("des:a.imgZoom",{toolbar:1,mag:1,titlePath:"par:/nsi:/des:span.capTi"});

</script>
  <link type="text/css" rel="stylesheet" href="../skin/css/main.css" media="all">
  <link type="text/css" rel="stylesheet" href="../skin/css/skin.css" media="all">
  <link type="text/css" rel="stylesheet" href="../skin/css/print.css" media="print">
  <script src="https://cdn.jwplayer.com/libraries/DyAyCxUH.js"></script>
  <script>jwplayer.key="U+hpi4mMOTCDfyWL3FjgwMi/QSkehLvVr4cukDDoslCcpV31";</script>
  <script type="text/JavaScript">
outMgr.declareOutline("module-test-fonctionnel-webtest-panth.txt");
	</script>
  <script type="text/JavaScript">searchMgr.declareIndex("index.txt");
</script> </head>
 <body class="default module expUc">
  <div id="root"><header id="header" role="banner"><a class="btnZen" role="button" href="#" target="_self" title="Restaurer l'interface par d&eacute;faut." onclick="tplMgr.sToggleZen();return false;"><span>Restaurer</span></a><h1><span>Les tests fonctionnels avec WebTestCase et Panther</span></h1><nav role="navigation"><ul id="accessibility"><li class="waiContent"><a href="#content"><span>contenu</span></a></li><li class="waiMenu"><a href="#menu"><span>menu</span></a></li><li class="waiNav"><a href="#navigation"><span>navigation</span></a></li><li class="waiTools"><a href="#tools"><span>outils</span></a></li></ul></nav></header><main id="main" role="main"><div id="document"><div id="content" tabindex="-1"><div class="scroller"><hr class="hidden"><section class="hBk article expUc"><h2 class="hBk_ti"><span>Tests fonctionnels avec WebTestCase</span></h2><div class="hBk_co "><div class="iBk info"><div class="iBk_co "><div class="rBk "><p><strong class="txt_emp_is ">Dur&eacute;e&nbsp;:</strong> 1&nbsp;h</p><p><strong class="txt_emp_is ">Environnement de travail&nbsp;:</strong> Visual Studio Code (ou tout autre &eacute;diteur de texte), PHP, Composer, Symfony CLI, PHPUnit</p><p><strong class="txt_emp_is ">Pr&eacute;-requis&nbsp;:</strong> PHP, les tests unitaires avec PHPUnit, Twig</p></div></div></div><div class="iBk info"><div class="iBk_co "><div class="rBk res"><figure role="group" class="resInFlow remoteVideo"><div class="resInFlow_co "><div class="jwplayer" data-media-id="StudiFr/S3NPkwfs"></div></div></figure></div></div></div><div class="context pBk"><h3 class="context_ti pBk_ti"><span><i class="type"><span>Contexte</span></i><span class="hidden"> : </span><span class="title"></span></span></h3><div class="context_co pBk_co"><div class="rBk "><p>Vous avez d&eacute;couvert pr&eacute;c&eacute;demment qu'il est essentiel de tester vos programmes afin de d&eacute;tecter et corriger des bogues et comportements ne r&eacute;pondant pas aux attentes initiales.</p></div><div class="rBk "><p>Pour ce faire, il existe les tests unitaires mais aussi les tests fonctionnels.</p></div><div class="rBk "><p>Les tests fonctionnels permettent de tester toutes les fonctionnalit&eacute;s d'une application web.</p></div><div class="rBk "><p>Ce type de test permet ainsi de tester les diff&eacute;rentes couches de l'application, de la requ&ecirc;te envoy&eacute;e depuis le client jusqu'&agrave; la r&eacute;ponse renvoy&eacute;e par le serveur.</p></div><div class="rBk "><p>Contrairement aux tests unitaires, les tests fonctionnels permettent de tester de nombreux aspects de vos applications&nbsp;: les entit&eacute;s, les contr&ocirc;leurs, les templates ou encore les routes.</p></div><div class="rBk "><p>Avec Symfony, ces sc&eacute;narios de tests peuvent &ecirc;tre automatis&eacute;s.</p></div></div></div><div class="iBk info"><div class="iBk_co "><div class="rBk res"><figure role="group" class="resInFlow remoteVideo"><div class="resInFlow_co "><div class="jwplayer" data-media-id="StudiFr/WgcvLmou"></div></div></figure></div></div></div><div class="iBk info"><h3 class="iBk_ti"><span>Objectifs</span></h3><div class="iBk_co "><div class="rBk "><ul class="txt_il "><li class="txt_ili "><p>D&eacute;couvrir les tests fonctionnels</p></li><li class="txt_ili "><p>D&eacute;couvrir le bundle <code class="txt_code_is ">WebTestCase</code> et ses fonctionnalit&eacute;s</p></li><li class="txt_ili "><p>R&eacute;diger un test fonctionnel simple &agrave; l'aide de la classe <code class="txt_code_is ">WebTestCase</code></p></li><li class="txt_ili "><p>D&eacute;finir un sc&eacute;nario de test</p></li><li class="txt_ili "><p>Ex&eacute;cuter un sc&eacute;nario de test</p></li></ul></div></div></div><div class="iBk info"><h3 class="iBk_ti"><span>Mise en situation</span></h3><div class="iBk_co "><div class="rBk "><p>Pour tester fonctionnellement une application Symfony, nous utilisons un bundle permettant de simuler un navigateur web, et ainsi tester toutes les fonctionnalit&eacute;s que nous souhaitons. Ce bundle est repr&eacute;sent&eacute; par la classe <code class="txt_code_is ">WebTestCase</code>. Pour utiliser ses diff&eacute;rentes m&eacute;thodes, il nous suffira de l'&eacute;tendre depuis notre classe de test.</p></div><div class="rBk "><p>Nous d&eacute;couvrirons dans ce chapitre que <code class="txt_code_is ">WebTestCase</code> offre de nombreuses fonctionnalit&eacute;s utiles &agrave; la r&eacute;daction des sc&eacute;narios de test. En voici quelques-unes&nbsp;:</p></div><div class="rBk "><ul class="txt_il "><li class="txt_ili "><p>La v&eacute;rification du code de statut d'une r&eacute;ponse HTTP,</p></li><li class="txt_ili "><p>La v&eacute;rification des routes Symfony,</p></li><li class="txt_ili "><p>La v&eacute;rification de la pr&eacute;sence d'&eacute;l&eacute;ment dans le DOM,</p></li><li class="txt_ili "><p>Le test de formulaire,</p></li><li class="txt_ili "><p>Etc.</p></li></ul></div><div class="rBk "><p>En ex&eacute;cutant un sc&eacute;nario de test fonctionnel, nous pouvons comparer les r&eacute;sultats obtenus avec ceux attendus pour d&eacute;terminer si un test a &eacute;t&eacute; un succ&egrave;s ou non.</p></div></div></div><div class="iBk info"><div class="iBk_co "><div class="rBk "><p>Les tests fonctionnels se chargent de v&eacute;rifier diff&eacute;rentes couches d'une application Symfony, allant du routage jusqu'aux vues.</p></div><div class="rBk "><p>Pour ce faire, la classe <code class="txt_code_is ">WebTestCase</code> va simuler un client HTTP. Afin que cette simulation soit fonctionnelle, il vous faut installer pr&eacute;alablement le composant Symfony BrowserKit, charg&eacute; de simuler le comportement d'un navigateur web.</p></div><div class="rBk "><p>Voici la commande &agrave; saisir pour installer cette d&eacute;pendance au sein de votre projet Symfony&nbsp;: <code class="txt_code_is ">$ composer require symfony/browser-kit</code>.</p></div><div class="rBk "><p>Un test fonctionnel est repr&eacute;sent&eacute; par un fichier PHP, g&eacute;n&eacute;ralement situ&eacute; dans le r&eacute;pertoire <code class="txt_code_is ">./tests/Controller</code> d'une application Symfony.</p></div><div class="rBk "><p>Imaginez un contr&ocirc;leur tr&egrave;s simple, puisqu'il se contente de renvoyer un template Twig affichant un message de bienvenue avec le nom de l'application.</p></div><div class="rBk listing"><div><div class="code"><div class="code-form "><div class="CodeMirror-static cm-s-default" data-lang="text/x-php"><div class="CodeMirror-code"><div class="CodeMirror-line"><div class="CodeMirror-linenumber">1</div><pre><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">2</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">3</div><pre><span class="cm-keyword">namespace</span> <span class="cm-def">App\Controller</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">4</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">5</div><pre><span class="cm-keyword">use</span> <span class="cm-variable">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">6</div><pre><span class="cm-keyword">use</span> <span class="cm-variable">Symfony\Component\Routing\Annotation\Route</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">7</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">8</div><pre><span class="cm-keyword">class</span> <span class="cm-def">WelcomeController</span> <span class="cm-keyword">extends</span> <span class="cm-variable">AbstractController</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">9</div><pre>{</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">10</div><pre>    <span class="cm-comment">/**</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">11</div><pre>     <span class="cm-comment">* @Route(&quot;/&quot;)</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">12</div><pre>     <span class="cm-comment">*/</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">13</div><pre>    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">welcome</span>()</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">14</div><pre>    {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">15</div><pre>        <span class="cm-keyword">return</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">render</span>(<span class="cm-string">'welcome.html.twig'</span>, [</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">16</div><pre>            <span class="cm-string">'appName'</span> <span class="cm-operator">=&gt;</span> <span class="cm-string">&quot;Ma Super Appli&quot;</span>,</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">17</div><pre>        ]);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">18</div><pre>    }</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">19</div><pre>}</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">20</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">21</div><pre><span class="cm-operator">?&gt;</span></pre></div></div></div></div><pre class="code-raw noIndex " style="display:none;">&lt;?php

namespace App\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\Routing\Annotation\Route;

class WelcomeController extends AbstractController
{
    /**
     * @Route(&quot;/&quot;)
     */
    public function welcome()
    {
        return $this-&gt;render('welcome.html.twig', [
            'appName' =&gt; &quot;Ma Super Appli&quot;,
        ]);
    }
}

?&gt;</pre></div></div></div><div class="rBk listing"><div><div class="code"><div class="code-form "><div class="CodeMirror-static cm-s-default" data-lang="text/x-php"><div class="CodeMirror-code"><div class="CodeMirror-line"><div class="CodeMirror-linenumber">1</div><pre>{<span class="cm-operator">%</span> <span class="cm-keyword">extends</span> <span class="cm-string">&quot;base.html.twig&quot;</span> <span class="cm-operator">%</span>}</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">2</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">3</div><pre>{<span class="cm-operator">%</span> <span class="cm-variable">block</span> <span class="cm-variable">body</span> <span class="cm-operator">%</span>}</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">4</div><pre>  <span class="cm-operator">&lt;</span><span class="cm-variable">h2</span><span class="cm-operator">&gt;</span><span class="cm-variable">Bienvenue</span> <span class="cm-variable">sur</span> {{ <span class="cm-variable">appName</span> }}<span class="cm-operator">&lt;/</span><span class="cm-variable">h2</span><span class="cm-operator">&gt;</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">5</div><pre>{<span class="cm-operator">%</span> <span class="cm-variable">endblock</span> <span class="cm-operator">%</span>}</pre></div></div></div></div><pre class="code-raw noIndex " style="display:none;">{% extends &quot;base.html.twig&quot; %}

{% block body %}
  &lt;h2&gt;Bienvenue sur {{ appName }}&lt;/h2&gt;
{% endblock %}</pre></div></div></div></div></div><div class="method pBk"><h3 class="method_ti pBk_ti"><span><i class="type"><span>M&eacute;thode</span></i><span class="hidden"> : </span><span class="title"></span></span></h3><div class="method_co pBk_co"><div class="rBk "><p>Vous &eacute;crivez vos tests dans le dossier du m&ecirc;me nom, situ&eacute; &agrave; la racine de votre projet Symfony. Dans ce r&eacute;pertoire, vous reproduisez la m&ecirc;me arborescence que vous suivez pour atteindre la classe &agrave; tester.</p></div><div class="rBk "><p>Ainsi, pour tester le bon fonctionnement de la page issue du contr&ocirc;leur <code class="txt_code_is ">WelcomeController</code>, vous cr&eacute;ez un fichier <code class="txt_code_is ">./tests/Controller/WelcomeControllerTest.php</code> &eacute;tendant la classe de base des tests fonctionnels Symfony, <code class="txt_code_is ">Symfony\Bundle\FrameworkBundle\Test\WebTestCase</code>.</p></div><div class="rBk listing"><div><div class="code"><div class="code-form "><div class="CodeMirror-static cm-s-default" data-lang="text/x-php"><div class="CodeMirror-code"><div class="CodeMirror-line"><div class="CodeMirror-linenumber">1</div><pre><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">2</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">3</div><pre><span class="cm-keyword">namespace</span> <span class="cm-def">App\Tests\Controller</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">4</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">5</div><pre><span class="cm-keyword">use</span> <span class="cm-variable">Symfony\Bundle\FrameworkBundle\Test\WebTestCase</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">6</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">7</div><pre><span class="cm-keyword">class</span> <span class="cm-def">WelcomeControllerTest</span> <span class="cm-keyword">extends</span> <span class="cm-variable">WebTestCase</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">8</div><pre>{</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">9</div><pre>    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">testWelcomePageIsUp</span>()</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">10</div><pre>    {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">11</div><pre>        <span class="cm-variable-2">$client</span> <span class="cm-operator">=</span> <span class="cm-keyword">static</span>::<span class="cm-variable">createClient</span>();</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">12</div><pre>        <span class="cm-variable-2">$client</span><span class="cm-operator">-&gt;</span><span class="cm-variable">request</span>(<span class="cm-string">'GET'</span>, <span class="cm-string">'/'</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">13</div><pre>        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">assertSame</span>(<span class="cm-number">200</span>, <span class="cm-variable-2">$client</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getResponse</span>()<span class="cm-operator">-&gt;</span><span class="cm-variable">getStatusCode</span>());</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">14</div><pre>	   <span class="cm-keyword">echo</span> <span class="cm-variable-2">$client</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getResponse</span>()<span class="cm-operator">-&gt;</span><span class="cm-variable">getContent</span>();</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">15</div><pre>    }</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">16</div><pre>}</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">17</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">18</div><pre><span class="cm-operator">?&gt;</span></pre></div></div></div></div><pre class="code-raw noIndex " style="display:none;">&lt;?php

namespace App\Tests\Controller;

use Symfony\Bundle\FrameworkBundle\Test\WebTestCase;

class WelcomeControllerTest extends WebTestCase
{
    public function testWelcomePageIsUp()
    {
        $client = static::createClient();
        $client-&gt;request('GET', '/');
        $this-&gt;assertSame(200, $client-&gt;getResponse()-&gt;getStatusCode());
	   echo $client-&gt;getResponse()-&gt;getContent();
    }
}

?&gt;</pre></div></div></div></div></div><div class="iBk info"><div class="iBk_co "><div class="rBk "><p>Cette classe contient une m&eacute;thode <code class="txt_code_is ">testWelcomePageIsUp()</code> charg&eacute;e de tester le rendu de la page g&eacute;n&eacute;r&eacute;e par votre contr&ocirc;leur. Notez que, comme les fonctions de tests unitaires, on place le suffixe &laquo;&nbsp;<i class="txt_spec_is ">test</i>&nbsp;&raquo; devant chaque nom de fonction de test fonctionnel.</p></div><div class="rBk "><p>Dans cette fonction, nous nous basons sur la m&eacute;thode statique <code class="txt_code_is ">createClient()</code> issue de la classe <code class="txt_code_is ">WebTestCase</code> pour simuler un client HTTP. Ce client est repr&eacute;sent&eacute; par un objet PHP et peut appeler la m&eacute;thode <code class="txt_code_is ">request()</code> permettant de requ&ecirc;ter une URL. Cette m&eacute;thode attend 2&nbsp;arguments&nbsp;:</p></div><div class="rBk "><ul class="txt_il "><li class="txt_ili "><p>La m&eacute;thode HTTP (ici, <code class="txt_code_is ">GET</code>)</p></li><li class="txt_ili "><p>La route &agrave; requ&ecirc;ter (ici, <code class="txt_code_is ">/</code>)</p></li></ul></div><div class="rBk "><p>Dans la m&ecirc;me logique, il est possible de r&eacute;cup&eacute;rer la r&eacute;ponse re&ccedil;ue par ce m&ecirc;me client. Pour ce faire, il suffit d'appeler la m&eacute;thode <code class="txt_code_is ">getResponse()</code>, toujours issue de l'objet <code class="txt_code_is ">$client</code>. Cette m&eacute;thode renvoie un simple objet <code class="txt_code_is ">Response</code>, duquel on peut r&eacute;cup&eacute;rer simplement le code de statut &agrave; l'aide de la m&eacute;thode <code class="txt_code_is ">getStatusCode()</code> afin de nous assurer qu'il s'agit bien d'un &laquo;&nbsp;<i class="txt_spec_is ">200&nbsp;-&nbsp;OK</i>&nbsp;&raquo;.</p></div><div class="rBk "><p>Notez qu'ici, les objets <code class="txt_code_is ">Request</code> et <code class="txt_code_is ">Response</code> ne correspondent pas &agrave; des instances des classes <code class="txt_code_is ">Symfony\Component\HttpFoundation\Request</code> et <code class="txt_code_is ">Symfony\Component\HttpFoundation\Response</code>, mais sont issus en r&eacute;alit&eacute; des classes <code class="txt_code_is ">Symfony\Component\BrowserKit\Request</code> et <code class="txt_code_is ">Symfony\Component\BrowserKit\Response</code>.</p></div><div class="rBk "><p>Dans le cadre d'un test, vous avez besoin de r&eacute;aliser une assertion. Il s'agit d'un &eacute;nonc&eacute; consid&eacute;r&eacute; comme &eacute;tant vrai. En l'occurrence, vous consid&eacute;rez que le code de statut re&ccedil;u dans la r&eacute;ponse HTTP doit &ecirc;tre &eacute;gal &agrave;&nbsp;200. Pour r&eacute;diger cette assertion, vous utilisez la m&eacute;thode <code class="txt_code_is ">assertSame()</code>, issue de la classe <code class="txt_code_is ">WebTestCase</code>. Cette m&eacute;thode prend en arguments 2&nbsp;valeurs &agrave; comparer&nbsp;:</p></div><div class="rBk "><ul class="txt_il "><li class="txt_ili "><p>La valeur attendue</p></li><li class="txt_ili "><p>La valeur r&eacute;ellement obtenue</p></li></ul></div><div class="rBk "><p>Si les deux valeurs sont &eacute;gales, le test est r&eacute;ussi.</p></div><div class="rBk "><p>Enfin, la ligne suivante permet d'afficher, au format HTML, le contenu de la r&eacute;ponse dans le terminal via la m&eacute;thode <code class="txt_code_is ">getContent()</code> issue de la classe <code class="txt_code_is ">Response</code>.</p></div><div class="rBk "><p>Pour ex&eacute;cuter les tests situ&eacute;s dans le dossier <code class="txt_code_is ">./tests</code>, vous utilisez la commande <code class="txt_code_is ">$ php bin/phpunit</code>.</p></div><div class="rBk res"><figure role="group" class="resInFlow png"><div class="resInFlow_co "><a href="../res/test-fonctionnel-webtest-pa-i1.png" class="imgZoom" target="_blank" onclick="scImgMgr.loading(); return false;" title="Cliquez pour agrandir (nouvelle fen&ecirc;tre)"><img src="../res/test-fonctionnel-webtest-pa-i1_1.png" width="630" height="290" alt></a></div></figure></div><div class="rBk "><p>Voyez la sortie de console affich&eacute;e en cas de r&eacute;ussite&nbsp;: un test et une assertion r&eacute;ussis.</p></div><div class="rBk "><p>Pour rappel, le test fait r&eacute;f&eacute;rence &agrave; la m&eacute;thode <code class="txt_code_is ">testWelcomePageIsUp()</code>, tandis que l'assertion se base sur l'appel de la m&eacute;thode <code class="txt_code_is ">assertSame()</code>. Remarquez &eacute;galement que le contenu HTML s'affiche comme pr&eacute;vu en console.</p></div><div class="rBk "><p>Il est possible de le stocker dans un fichier HTML &agrave; ouvrir dans un navigateur bien r&eacute;el pour tester son affichage de mani&egrave;re plus concr&egrave;te. Pour ce faire, on utilise l'op&eacute;rateur chevron fermant &gt;, suivi du nom du fichier dans lequel on souhaite ajouter la sortie. Ce qui donne la commande <code class="txt_code_is ">$ php bin/phpunit &gt; test.html</code> dans le cas o&ugrave; vous souhaitez effectivement stocker le r&eacute;sultat HTML dans le fichier <code class="txt_code_is ">test.html</code>.</p></div><div class="rBk res"><figure role="group" class="resInFlow png"><div class="resInFlow_co "><a href="../res/test-fonctionnel-webtest-pa-i2.png" class="imgZoom" target="_blank" onclick="scImgMgr.loading(); return false;" title="Cliquez pour agrandir (nouvelle fen&ecirc;tre)"><img src="../res/test-fonctionnel-webtest-pa-i2_1.png" width="630" height="245" alt></a></div></figure></div><div class="rBk "><p>Notez, qu'en cas d'erreur dans un test ou une assertion, la console le signale.</p></div><div class="rBk "><p>Dans cet exemple, on a volontairement requ&ecirc;t&eacute; une route inexistante (<code class="txt_code_is ">/home</code>). Ainsi, le code de statut re&ccedil;u est &laquo;&nbsp;<i class="txt_spec_is ">404&nbsp;-&nbsp;Not Found</i>&nbsp;&raquo;, et non plus &laquo;&nbsp;<i class="txt_spec_is ">200&nbsp;-&nbsp;OK</i>&nbsp;&raquo;.</p></div></div></div><div class="syntax pBk"><h3 class="syntax_ti pBk_ti"><span><i class="type"><span>Syntaxe</span></i><span class="hidden"> : </span><span class="title">&Agrave; retenir</span></span></h3><div class="syntax_co pBk_co"><div class="rBk "><p>Cette partie comporte plusieurs syntaxes essentielles &agrave; retenir. En premier lieu, pensez &agrave; installer le composant Symfony <strong class="txt_emp_is ">BrowserKit</strong> pour simuler le comportement d'un navigateur web avec la commande <code class="txt_code_is ">$ composer require symfony/browser-kit</code>.</p></div><div class="rBk "><p>Retenez &eacute;galement que le nom d'une classe de test, ainsi que celui du fichier dans lequel elle est &eacute;crite, prennent toujours le suffixe &laquo;&nbsp;<i class="txt_spec_is ">test</i>&nbsp;&raquo;, tandis qu'une m&eacute;thode de test prend toujours le pr&eacute;fixe &laquo;&nbsp;<i class="txt_spec_is ">test</i>&nbsp;&raquo;. Dans notre exemple, on a ainsi obtenu la classe de test <code class="txt_code_is ">WelcomeControllerTest</code> et la m&eacute;thode de test <code class="txt_code_is ">testWelcomePageIsUp()</code>.</p></div><div class="rBk "><p>Pour tester votre application fonctionnellement, vous avez besoin du bundle <strong class="txt_emp_is ">WebTestCase</strong> issu de la classe <code class="txt_code_is ">Symfony\Bundle\FrameworkBundle\Test\WebTestCase</code>.</p></div><div class="rBk "><p>Gr&acirc;ce &agrave; cette classe, il est possible d'appeler la m&eacute;thode statique <code class="txt_code_is ">createClient()</code> pour simuler un client HTTP. Les m&eacute;thodes <code class="txt_code_is ">request()</code> et <code class="txt_code_is ">getResponse()</code> sont accessibles depuis un objet de type <code class="txt_code_is ">Client</code> pour envoyer une requ&ecirc;te HTTP et r&eacute;cup&eacute;rer une r&eacute;ponse.</p></div><div class="rBk "><p>Enfin, la m&eacute;thode <code class="txt_code_is ">assertSame()</code>, issue de la classe <code class="txt_code_is ">WebTestCase</code>, permet de comparer deux valeurs entre elles. Si elles sont &eacute;gales, l'assertion est v&eacute;rifi&eacute;e et le test est r&eacute;ussi.</p></div><div class="rBk "><p>Pour ex&eacute;cuter les tests contenus dans le dossier du m&ecirc;me nom, il suffit de saisir la commande <code class="txt_code_is ">$ php bin/phpunit</code>.</p></div></div></div><div class="method pBk"><h3 class="method_ti pBk_ti"><span><i class="type"><span>M&eacute;thode</span></i><span class="hidden"> : </span><span class="title"></span></span></h3><div class="method_co pBk_co"><div class="rBk "><p>Vous savez d&eacute;sormais tester une route, ainsi que le statut des r&eacute;ponses qu'elle renvoie. Le bundle Symfony <strong class="txt_emp_is ">WebTestCase</strong> permet n&eacute;anmoins bien d'autres choses, notamment le test de pr&eacute;sence d'&eacute;l&eacute;ment dans le DOM.</p></div><div class="rBk "><p>Pour ce faire, il faut pr&eacute;alablement installer la d&eacute;pendance CSS <strong class="txt_emp_is ">Selector</strong> afin de s&eacute;lectionner des &eacute;l&eacute;ments directement depuis le DOM. Voici la commande &agrave; saisir pour installer la d&eacute;pendance au sein de notre projet Symfony&nbsp;: <code class="txt_code_is ">composer require symfony/css-selector</code>.</p></div><div class="rBk "><p>Toujours en nous basant sur le simple contr&ocirc;leur que nous avons &eacute;crit pr&eacute;c&eacute;demment, vous allez maintenant vous assurer que la page affich&eacute;e gr&acirc;ce &agrave; ce contr&ocirc;leur contient bien, comme convenu, un texte de bienvenue avec le titre de votre application Symfony.</p></div><div class="rBk listing"><div><div class="code"><div class="code-form "><div class="CodeMirror-static cm-s-default" data-lang="text/x-php"><div class="CodeMirror-code"><div class="CodeMirror-line"><div class="CodeMirror-linenumber">1</div><pre>	<span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">testWelcomePage</span>()</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">2</div><pre>    {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">3</div><pre>        <span class="cm-variable-2">$client</span> <span class="cm-operator">=</span> <span class="cm-keyword">static</span>::<span class="cm-variable">createClient</span>();</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">4</div><pre>        <span class="cm-variable-2">$crawler</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$client</span><span class="cm-operator">-&gt;</span><span class="cm-variable">request</span>(<span class="cm-string">'GET'</span>, <span class="cm-string">'/'</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">5</div><pre>        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">assertSame</span>(<span class="cm-number">1</span>, <span class="cm-variable-2">$crawler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">filter</span>(<span class="cm-string">'html:contains(&quot;Bienvenue sur Ma Super Appli&quot;)'</span>)<span class="cm-operator">-&gt;</span><span class="cm-builtin">count</span>());</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">6</div><pre>    }</pre></div></div></div></div><pre class="code-raw noIndex " style="display:none;">	public function testWelcomePage()
    {
        $client = static::createClient();
        $crawler = $client-&gt;request('GET', '/');
        $this-&gt;assertSame(1, $crawler-&gt;filter('html:contains(&quot;Bienvenue sur Ma Super Appli&quot;)')-&gt;count());
    }</pre></div></div></div></div></div><div class="iBk info"><div class="iBk_co "><div class="rBk "><p>Cette m&eacute;thode de test ressemble beaucoup &agrave; celle que nous avons d&eacute;crite pr&eacute;c&eacute;demment. Remarquez que, cette fois, vous stockez dans une variable <code class="txt_code_is ">$crawler</code> l'objet retourn&eacute; par l'appel de la m&eacute;thode <code class="txt_code_is ">request()</code>. En r&eacute;alit&eacute;, cet objet va vous permettre d'interagir directement avec le DOM de la page requ&ecirc;t&eacute;e.</p></div><div class="rBk "><p>&Agrave; la ligne suivante, vous cr&eacute;ez une nouvelle assertion gr&acirc;ce &agrave; la m&eacute;thode <code class="txt_code_is ">assertSame()</code>. Comme vous le savez, elle va se contenter de comparer la valeur&nbsp;1 avec une autre valeur num&eacute;rique.</p></div><div class="rBk "><p>Ici, le second argument repr&eacute;sente un appel &agrave; la m&eacute;thode <code class="txt_code_is ">filter()</code> depuis l'objet <i class="txt_spec_is ">$crawler</i>. Cette m&eacute;thode va permettre de r&eacute;cup&eacute;rer une ou plusieurs informations en rapport avec un &eacute;l&eacute;ment du DOM. Il peut s'agir d'un n&oelig;ud <code class="txt_code_is ">div</code>, <code class="txt_code_is ">p</code>, ou encore <code class="txt_code_is ">span</code>, par exemple. Cette m&eacute;thode attend un s&eacute;lecteur CSS en argument.</p></div><div class="rBk "><p>Ici, vous cherchez &agrave; r&eacute;cup&eacute;rer l'&eacute;l&eacute;ment HTML contenant le texte &laquo;&nbsp;<i class="txt_spec_is ">Bienvenue sur Ma Super Appli</i>&nbsp;&raquo;. Pour rappel, &laquo;&nbsp;<i class="txt_spec_is ">Ma Super Appli</i>&nbsp;&raquo; correspond au nom choisi pour notre application Symfony.</p></div><div class="rBk "><p>Vous l'aurez probablement compris, cette m&eacute;thode <code class="txt_code_is ">filter()</code> nous retourne un tableau, duquel on r&eacute;cup&egrave;re le nombre d'&eacute;l&eacute;ments gr&acirc;ce &agrave; la fonction PHP <code class="txt_code_is ">count()</code>. En d&eacute;finitif, vous vous assurez ici que le HTML de votre page web contient bien le texte &laquo;&nbsp;<i class="txt_spec_is ">Bienvenue sur Ma Super Appli</i>&nbsp;&raquo; une fois.</p></div><div class="rBk "><p>Vous pouvez d&eacute;sormais ex&eacute;cuter vos tests &agrave; nouveau et d&eacute;couvrir que deux tests et deux assertions ont &eacute;t&eacute; ex&eacute;cut&eacute;s et r&eacute;ussis&nbsp;:</p></div><div class="rBk res"><figure role="group" class="resInFlow png"><div class="resInFlow_co "><a href="../res/test-fonctionnel-webtest-pa-i3.png" class="imgZoom" target="_blank" onclick="scImgMgr.loading(); return false;" title="Cliquez pour agrandir (nouvelle fen&ecirc;tre)"><img src="../res/test-fonctionnel-webtest-pa-i3_1.png" width="630" height="138" alt></a></div></figure></div><div class="rBk "><p>Un objet issu de la classe <code class="txt_code_is ">Crawler</code> dispose de bien d'autres m&eacute;thodes. Pour creuser le sujet et d&eacute;couvrir quels &eacute;l&eacute;ments du DOM peuvent &ecirc;tre parcourus depuis cet objet, consultez la documentation officielle de Symfony d&eacute;di&eacute;e &agrave; ce sujet&nbsp;:</p></div><div class="rBk "><p><a class="op_txt_ul" target="_blank" href="https://symfony.com/doc/current/testing.html#the-crawler" rel="noopener" title="Symfony (nouvelle fen&ecirc;tre)"><span>Symfony</span></a></p></div></div></div><div class="syntax pBk"><h3 class="syntax_ti pBk_ti"><span><i class="type"><span>Syntaxe</span></i><span class="hidden"> : </span><span class="title">&Agrave; retenir</span></span></h3><div class="syntax_co pBk_co"><div class="rBk "><p>En r&eacute;sum&eacute;, <strong class="txt_emp_is ">WebTestCase</strong> permet de r&eacute;cup&eacute;rer des &eacute;l&eacute;ments contenus dans le DOM d'une page HTML. Pour ce faire, il est important d'installer pr&eacute;alablement la d&eacute;pendance CSS <strong class="txt_emp_is ">Selector</strong> au sein du projet Symfony dans lequel vous souhaitez r&eacute;aliser vos tests, via la commande&nbsp;: <code class="txt_code_is ">composer require symfony/css-selector</code>.</p></div><div class="rBk "><p>Une instance de la classe <code class="txt_code_is ">Crawler</code> est retourn&eacute;e par la m&eacute;thode <code class="txt_code_is ">request()</code> que vous utilisez pour requ&ecirc;ter les routes de votre application. Il est alors possible d'utiliser l'objet ainsi obtenu pour r&eacute;cup&eacute;rer des &eacute;l&eacute;ments du DOM de la page web correspondante. La m&eacute;thode <code class="txt_code_is ">filter()</code> permet justement de r&eacute;cup&eacute;rer un n&oelig;ud du DOM correspondant au s&eacute;lecteur CSS pass&eacute; en argument. Bien que cette m&eacute;thode soit la plus utilis&eacute;e, il en existe bien d'autres, consultables depuis la documentation officielle de Symfony.</p></div></div></div><div class="method pBk"><h3 class="method_ti pBk_ti"><span><i class="type"><span>M&eacute;thode</span></i><span class="hidden"> : </span><span class="title"></span></span></h3><div class="method_co pBk_co"><div class="rBk "><p>Dans cette derni&egrave;re section, vous allez r&eacute;diger un sc&eacute;nario de test charg&eacute; de compl&eacute;ter et soumettre un formulaire HTML simple, afin de tester sa bonne ex&eacute;cution.</p></div><div class="rBk "><p>Imaginez un nouveau contr&ocirc;leur charg&eacute; de g&eacute;rer l'affichage et la soumission d'un formulaire HTML simple, puisqu'il permet d'ajouter un nouveau produit &agrave; une base de donn&eacute;es en y saisissant uniquement un nom et une description.</p></div><div class="rBk listing"><div><div class="code"><div class="code-form "><div class="CodeMirror-static cm-s-default" data-lang="text/x-php"><div class="CodeMirror-code"><div class="CodeMirror-line"><div class="CodeMirror-linenumber">1</div><pre><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">2</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">3</div><pre><span class="cm-keyword">namespace</span> <span class="cm-def">App\Controller</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">4</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">5</div><pre><span class="cm-keyword">use</span> <span class="cm-variable">App\Entity\Product</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">6</div><pre><span class="cm-keyword">use</span> <span class="cm-variable">App\Form\ProductType</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">7</div><pre><span class="cm-keyword">use</span> <span class="cm-variable">Symfony\Component\HttpFoundation\Response</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">8</div><pre><span class="cm-keyword">use</span> <span class="cm-variable">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">9</div><pre><span class="cm-keyword">use</span> <span class="cm-variable">Symfony\Component\HttpFoundation\Request</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">10</div><pre><span class="cm-keyword">use</span> <span class="cm-variable">Symfony\Component\Routing\Annotation\Route</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">11</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">12</div><pre><span class="cm-keyword">class</span> <span class="cm-def">AddProductController</span> <span class="cm-keyword">extends</span> <span class="cm-variable">AbstractController</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">13</div><pre>{</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">14</div><pre>    <span class="cm-comment">/**</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">15</div><pre>     <span class="cm-comment">* @Route(&quot;/add-product&quot;)</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">16</div><pre>     <span class="cm-comment">*/</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">17</div><pre>    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">addProduct</span>(<span class="cm-variable">Request</span> <span class="cm-variable-2">$request</span>): <span class="cm-variable">Response</span> </pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">18</div><pre>    {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">19</div><pre>        <span class="cm-variable-2">$product</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Product</span>();</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">20</div><pre>        <span class="cm-variable-2">$form</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">createForm</span>(<span class="cm-variable">ProductType</span>::<span class="cm-keyword">class</span>, <span class="cm-variable-2">$product</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">21</div><pre>        <span class="cm-variable-2">$form</span><span class="cm-operator">-&gt;</span><span class="cm-variable">handleRequest</span>(<span class="cm-variable-2">$request</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">22</div><pre>        </pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">23</div><pre>        <span class="cm-keyword">if</span> (<span class="cm-variable-2">$form</span><span class="cm-operator">-&gt;</span><span class="cm-variable">isSubmitted</span>() <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">$form</span><span class="cm-operator">-&gt;</span><span class="cm-variable">isValid</span>()) {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">24</div><pre>            <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addFlash</span>(<span class="cm-string">'success'</span>, <span class="cm-string">'Le produit a &eacute;t&eacute; cr&eacute;&eacute; avec succ&egrave;s !'</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">25</div><pre>            <span class="cm-keyword">return</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">redirect</span>(<span class="cm-string">'/'</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">26</div><pre>        }</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">27</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">28</div><pre>        <span class="cm-keyword">return</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">render</span>(<span class="cm-string">'addProduct.html.twig'</span>, [</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">29</div><pre>            <span class="cm-string">'form'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$form</span><span class="cm-operator">-&gt;</span><span class="cm-variable">createView</span>(),</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">30</div><pre>        ]);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">31</div><pre>    }</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">32</div><pre>}</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">33</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">34</div><pre><span class="cm-operator">?&gt;</span></pre></div></div></div></div><pre class="code-raw noIndex " style="display:none;">&lt;?php

namespace App\Controller;

use App\Entity\Product;
use App\Form\ProductType;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\Routing\Annotation\Route;

class AddProductController extends AbstractController
{
    /**
     * @Route(&quot;/add-product&quot;)
     */
    public function addProduct(Request $request): Response 
    {
        $product = new Product();
        $form = $this-&gt;createForm(ProductType::class, $product);
        $form-&gt;handleRequest($request);
        
        if ($form-&gt;isSubmitted() &amp;&amp; $form-&gt;isValid()) {
            $this-&gt;addFlash('success', 'Le produit a &eacute;t&eacute; cr&eacute;&eacute; avec succ&egrave;s !');
            return $this-&gt;redirect('/');
        }

        return $this-&gt;render('addProduct.html.twig', [
            'form' =&gt; $form-&gt;createView(),
        ]);
    }
}

?&gt;</pre></div></div></div></div></div><div class="iBk info"><div class="iBk_co "><div class="rBk "><p>Bien entendu, l'entit&eacute; <code class="txt_code_is ">Product</code>, le type de formulaire <code class="txt_code_is ">ProductType</code> et le template Twig <code class="txt_code_is ">addProduct.html.twig</code> ont &eacute;t&eacute; impl&eacute;ment&eacute;s en amont.</p></div><div class="rBk "><p>Partant de cette base, vous allez tenter de r&eacute;diger un test fonctionnel qui remplit et soumet le formulaire pour vous, tout en s'assurant que l'ex&eacute;cution s'est bien pass&eacute;e.</p></div><div class="rBk listing"><div><div class="code"><div class="code-form "><div class="CodeMirror-static cm-s-default" data-lang="text/x-php"><div class="CodeMirror-code"><div class="CodeMirror-line"><div class="CodeMirror-linenumber">1</div><pre>	<span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">testAddNewProduct</span>()</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">2</div><pre>    {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">3</div><pre>        <span class="cm-variable-2">$client</span> <span class="cm-operator">=</span> <span class="cm-keyword">static</span>::<span class="cm-variable">createClient</span>();</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">4</div><pre>        <span class="cm-variable-2">$crawler</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$client</span><span class="cm-operator">-&gt;</span><span class="cm-variable">request</span>(<span class="cm-string">'GET'</span>, <span class="cm-string">'/'</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">5</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">6</div><pre>        <span class="cm-variable-2">$link</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$crawler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">selectLink</span>(<span class="cm-string">&quot;Ajouter un produit&quot;</span>)<span class="cm-operator">-&gt;</span><span class="cm-builtin">link</span>();</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">7</div><pre>        <span class="cm-variable-2">$crawler</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$client</span><span class="cm-operator">-&gt;</span><span class="cm-variable">click</span>(<span class="cm-variable-2">$link</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">8</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">9</div><pre>        <span class="cm-variable-2">$form</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$crawler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">selectButton</span>(<span class="cm-string">&quot;Ajouter&quot;</span>)<span class="cm-operator">-&gt;</span><span class="cm-variable">form</span>();</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">10</div><pre>        <span class="cm-variable-2">$form</span>[<span class="cm-string">&quot;product[name]&quot;</span>] <span class="cm-operator">=</span> <span class="cm-string">&quot;Sauce tomate&quot;</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">11</div><pre>        <span class="cm-variable-2">$form</span>[<span class="cm-string">&quot;product[description]&quot;</span>] <span class="cm-operator">=</span> <span class="cm-string">&quot;La sauce tomate est une sauce sal&eacute;e, &agrave; base de tomates.&quot;</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">12</div><pre>        <span class="cm-variable-2">$client</span><span class="cm-operator">-&gt;</span><span class="cm-variable">submit</span>(<span class="cm-variable-2">$form</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">13</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">14</div><pre>        <span class="cm-variable-2">$crawler</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$client</span><span class="cm-operator">-&gt;</span><span class="cm-variable">followRedirect</span>();</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">15</div><pre>        <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">assertSame</span>(<span class="cm-number">1</span>, <span class="cm-variable-2">$crawler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">filter</span>(<span class="cm-string">&quot;div.alert.alert-success&quot;</span>)<span class="cm-operator">-&gt;</span><span class="cm-builtin">count</span>());</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">16</div><pre>    }</pre></div></div></div></div><pre class="code-raw noIndex " style="display:none;">	public function testAddNewProduct()
    {
        $client = static::createClient();
        $crawler = $client-&gt;request('GET', '/');

        $link = $crawler-&gt;selectLink(&quot;Ajouter un produit&quot;)-&gt;link();
        $crawler = $client-&gt;click($link);

        $form = $crawler-&gt;selectButton(&quot;Ajouter&quot;)-&gt;form();
        $form[&quot;product[name]&quot;] = &quot;Sauce tomate&quot;;
        $form[&quot;product[description]&quot;] = &quot;La sauce tomate est une sauce sal&eacute;e, &agrave; base de tomates.&quot;;
        $client-&gt;submit($form);

        $crawler = $client-&gt;followRedirect();
        $this-&gt;assertSame(1, $crawler-&gt;filter(&quot;div.alert.alert-success&quot;)-&gt;count());
    }</pre></div></div></div></div></div><div class="iBk info"><div class="iBk_co "><div class="rBk "><p>Dans un premier temps, vous simulez votre client HTTP. Vous r&eacute;cup&eacute;rez ensuite l'objet <code class="txt_code_is ">$crawler</code> via l'appel &agrave; la m&eacute;thode <code class="txt_code_is ">request()</code> pointant, non pas directement sur la page d'ajout d'un produit, mais bien sur la page d'accueil, afin de faire reproduire toutes les &eacute;tapes que vous r&eacute;aliseriez si vous testiez vous-m&ecirc;mes l'application.</p></div><div class="rBk "><p>Ainsi, c'est depuis la page d'accueil que vous auriez &agrave; cliquer sur le bouton &laquo;&nbsp;<strong class="txt_emp_is "><i class="txt_spec_is ">Ajouter un produit</i></strong>&nbsp;&raquo;. Pour ce faire, vous pouvez utiliser la m&eacute;thode <code class="txt_code_is ">selectLink()</code> issue de la classe <code class="txt_code_is ">Crawler</code>. Vous stockez ainsi le lien associ&eacute; au texte &laquo;&nbsp;<i class="txt_spec_is ">Ajouter un produit</i>&nbsp;&raquo; dans une variable subtilement intitul&eacute;e <code class="txt_code_is ">$link</code>, que vous passez ensuite en argument de la m&eacute;thode <code class="txt_code_is ">click()</code> associ&eacute;e &agrave; l'objet <code class="txt_code_is ">Client</code> et simulant, bien entendu, un clic sur un lien.</p></div><div class="rBk "><p>En toute rigueur, vous &ecirc;tes cens&eacute;s atteindre la page d'ajout de produit &agrave; ce stade du script. Comme pr&eacute;cis&eacute; pr&eacute;c&eacute;demment, cette page contient un formulaire HTML simple avec un champ textuel pour saisir le nom, et un autre pour saisir la description du produit.</p></div><div class="rBk "><p>Vous pouvez r&eacute;cup&eacute;rer tr&egrave;s simplement ce formulaire &agrave; l'aide de la m&eacute;thode <code class="txt_code_is ">selectButton()</code>, toujours issue de la classe <code class="txt_code_is ">Crawler</code> et prenant en argument une cha&icirc;ne de caract&egrave;res correspondant au texte associ&eacute; au bouton &agrave; s&eacute;lectionner. La m&eacute;thode <code class="txt_code_is ">form()</code> permet enfin de r&eacute;cup&eacute;rer le formulaire dans sa globalit&eacute; et sous forme d'un tableau PHP contenant ses diff&eacute;rents champs.</p></div><div class="rBk "><p>Pour r&eacute;cup&eacute;rer, puis associer une nouvelle valeur &agrave; ces champs, il suffit de les r&eacute;cup&eacute;rer depuis ce tableau en se basant sur la valeur pass&eacute;e &agrave; l'attribut <code class="txt_code_is ">name</code> de la balise de saisie. Celui-ci peut &ecirc;tre consult&eacute; depuis l'inspecteur de votre navigateur web si besoin.</p></div><div class="rBk "><p>De cette mani&egrave;re, vous affectez la valeur &laquo;&nbsp;<i class="txt_spec_is ">sauce tomate</i>&nbsp;&raquo; au nom du produit que vous cherchez &agrave; ajouter, avant d'appliquer le m&ecirc;me principe &agrave; sa description.</p></div><div class="rBk "><p>Une fois tous les champs compl&eacute;t&eacute;s de cette mani&egrave;re, on peut soumettre le formulaire gr&acirc;ce &agrave; la m&eacute;thode <code class="txt_code_is ">submit()</code> issue de la classe <code class="txt_code_is ">Client</code>.</p></div><div class="rBk "><p>En cas de redirection suite &agrave; la soumission des donn&eacute;es, comme c'est le cas ici, vous incitezle client &agrave; suivre cette redirection gr&acirc;ce &agrave; la m&eacute;thode <code class="txt_code_is ">followRedirect()</code>.</p></div><div class="rBk "><p>Enfin, vous pouvez &eacute;crire une assertion pour vous assurer que tout s'est bien pass&eacute;. En l'occurrence, un message flash est cens&eacute; s'afficher lorsque votre formulaire a &eacute;t&eacute; correctement soumis. Ce message est associ&eacute; &agrave; une classe Bootstrap <code class="txt_code_is ">alert alert-success</code>. Partant de ce constat, vous savez r&eacute;cup&eacute;rer un tel &eacute;l&eacute;ment en utilisant un s&eacute;lecteur CSS. Vous vous assurez ainsi que le message flash appara&icirc;t bien une fois apr&egrave;s la soumission. Si c'est le cas, la sortie de console associ&eacute;e &agrave; l'ex&eacute;cution du test confirme sa r&eacute;ussite, ainsi que celle de l'assertion qu'il contient.</p></div><div class="rBk "><p>Notez qu'il est possible d'utiliser un drapeau <code class="txt_code_is ">--filter</code> dans la commande d'ex&eacute;cution afin de pr&eacute;ciser quelle m&eacute;thode ou classe de test vous souhaitez ex&eacute;cuter&nbsp;: <code class="txt_code_is ">$ php bin/phpunit &mdash;filter testAddNewProduct</code>.</p></div><div class="rBk "><p>Ici, vous choisissez donc d'ex&eacute;cuter uniquement la m&eacute;thode <code class="txt_code_is ">testAddNewProduct()</code>.</p></div><div class="rBk "><p>Remarquez enfin que vous affectez une nouvelle valeur &agrave; votre variable <code class="txt_code_is ">$crawler</code> &agrave; chaque changement de page, afin qu'elle contienne le DOM de celle sur laquelle vous vous situez, et non plus celle de l'ancienne.</p></div></div></div><div class="syntax pBk"><h3 class="syntax_ti pBk_ti"><span><i class="type"><span>Syntaxe</span></i><span class="hidden"> : </span><span class="title">&Agrave; retenir</span></span></h3><div class="syntax_co pBk_co"><div class="rBk "><p>Dans cette section, retenez qu'un objet issu de la classe <code class="txt_code_is ">Crawler</code> est capable de r&eacute;cup&eacute;rer un &eacute;l&eacute;ment HTML correspondant &agrave; un lien &agrave; partir de la cha&icirc;ne de caract&egrave;res associ&eacute;e en utilisant la m&eacute;thode <code class="txt_code_is ">selectLink()</code>.</p></div><div class="rBk "><p>Pour l'utiliser, il vous suffit de r&eacute;cup&eacute;rer le lien en tant que tel via la m&eacute;thode <code class="txt_code_is ">link()</code> avant de simuler un clic en utilisant la m&eacute;thode <code class="txt_code_is ">click()</code> associ&eacute;e &agrave; notre instance <code class="txt_code_is ">Client</code>.</p></div><div class="rBk "><p>Dans la m&ecirc;me optique, l'instance de la classe <code class="txt_code_is ">Crawler</code> peut faire appel &agrave; la m&eacute;thode <code class="txt_code_is ">selectButton()</code> pour r&eacute;cup&eacute;rer le bouton associ&eacute; &agrave; une cha&icirc;ne de caract&egrave;res pass&eacute;e en argument. Si ce bouton est associ&eacute; &agrave; un formulaire, comme c'est le cas dans cet exemple, la m&eacute;thode <code class="txt_code_is ">form()</code> vous permet de le r&eacute;cup&eacute;rer sous forme d'un tableau associatif PHP.</p></div><div class="rBk "><p>Votre instance de la classe <code class="txt_code_is ">Client</code> peut &eacute;galement simuler la soumission d'un formulaire gr&acirc;ce &agrave; la m&eacute;thode <code class="txt_code_is ">submit()</code> avant de suivre la redirection &eacute;ventuelle qui fait suite &agrave; la soumission, en utilisant la m&eacute;thode <code class="txt_code_is ">followRedirect()</code>.</p></div><div class="rBk "><p>Enfin, retenez le drapeau <code class="txt_code_is ">--filter</code>, qui, associ&eacute; &agrave; la commande d'ex&eacute;cution des tests, va permettre de sp&eacute;cifier la classe ou la m&eacute;thode de test &agrave; ex&eacute;cuter.</p></div></div></div><div class="iBk info"><div class="iBk_co "><div class="rBk res"><figure role="group" class="resInFlow remoteVideo"><div class="resInFlow_co "><div class="jwplayer" data-media-id="StudiFr/SLK6M4Ir"></div></div></figure></div></div></div></div></section></div></div></div><div id="toolbox"><nav id="menu" class="pageSelector hidden" role="navigation" tabindex="-1" aria-label="menu principal"><hr class="hidden"><ul class="mnu static" data-totalPages="8"><li class="sel_yes anc_no type_l  dpt_0 expUc"><div class="lbl type_l" id="tests-fonctionnels-webtestcase.html"><span class="item"><span>Tests fonctionnels avec WebTestCase</span></span></div></li><li class="sel_no anc_no type_l  dpt_0 practUc"><div class="lbl type_l" id="tests-fonctionnels-webtestcase_1.html"><a href="tests-fonctionnels-webtestcase_1.html" target="_self" class="item"><span>Exercice&nbsp;: Exercice applicatif : Appliquer la notion</span></a></div></li><li class="sel_no anc_no type_l  dpt_0 expUc"><div class="lbl type_l" id="tests-fonctionnels-panther.html"><a href="tests-fonctionnels-panther.html" target="_self" class="item"><span>Tests fonctionnels avec Panther</span></a></div></li><li class="sel_no anc_no type_l  dpt_0 practUc"><div class="lbl type_l" id="tests-fonctionnels-panther_1.html"><a href="tests-fonctionnels-panther_1.html" target="_self" class="item"><span>Exercice&nbsp;: Exercice applicatif : Appliquer la notion</span></a></div></li><li class="sel_no anc_no type_l  dpt_0 expUc"><div class="lbl type_l" id="essentiel.html"><a href="essentiel.html" target="_self" class="item"><span>Essentiel</span></a></div></li><li class="sel_no anc_no type_b  type_b_c dpt_0 ueDiv"><div class="lbl type_b" id="exercice-final.html"><a href="exercice-final.html" target="_self" class="item"><span>Auto-&eacute;valuation</span></a></div></li></ul></nav><div id="tools" tabindex="-1"><hr class="hidden"><nav class="headingSelector" role="navigation"><ul class="mnu"><li class="anc_no home" data-position="uncle"><div class="lbl"><a href="module-test-fonctionnel-webtest-panth.html" target="_self" class="item" type="index" title="Page d'accueil du module"><span>Accueil</span></a></div></li><li class="anc_yes module" data-position="parent"><div class="lbl"><span class="item"><span>Module</span></span></div></li></ul></nav></div><div id="navigation" tabindex="-1"><hr class="hidden"><a class="showMenu" role="button" href="#" target="_self" title="Menu" onclick="studiMgr.showHideMenu();return false;"><span>Menu</span></a><div id="fontSize"><a class="increase_font" href="#" title="Augmenter taille police" onclick="studiMgr.increaseFont();return false;"></a><a class="decrease_font" href="#" title="Diminuer taille police" onclick="studiMgr.decreaseFont();return false;"></a></div><nav class="pageTurner" role="navigation"><a rel="prev" href="module-test-fonctionnel-webtest-panth.html" target="_self" class="btnNav prev" title="Pr&eacute;c&eacute;dent (Accueil)"><span>Pr&eacute;c&eacute;dent</span></a><a rel="next" href="tests-fonctionnels-webtestcase_1.html" target="_self" class="btnNav next" title="Suivant (Exercice&nbsp;: Exercice applicatif : Appliquer la notion)"><span>Suivant</span></a></nav></div></div></main><footer id="footer" role="contentinfo" tabindex="-1"><hr class="hidden"><a id="linkSp" target="_blank" href="https://www.scenari.org" title="R&eacute;alis&eacute; avec Scenari (nouvelle fen&ecirc;tre)"><span><img alt="R&eacute;alis&eacute; avec Scenari (nouvelle fen&ecirc;tre)" src="../skin/img/tpl/scBtn.png"></span></a></footer></div>
  <script type="text/JavaScript" src="../skin/js/skin.js"></script>
  <script type="text/javascript">searchMgr.init({searchType:"listResults"});studiMgr.init();tplMgr.init();outMgr.init();scCodeMgr.init();scImgMgr.init();scMediaMgr.init("ide:content/chi:div/chi:section/des:.mediaPlayer",{processYoutubeUrls:true});</script>
 </body>
</html>
