<!DOCTYPE html>
<html lang="fr">
 <head>
  <meta http-equiv="x-ua-compatible" content="IE=EDGE">
  <title>R&eacute;cup&eacute;ration asynchrone des donn&eacute;es [Ajax avec Axios et Symfony]</title>
  <meta charset="UTF-8">
  <meta name="generator" content="SCENARI 4.2.201 / opaleStudi 3.7.062">
  <meta name="revision" content="2021-04-13 09:03">
  <link rel="start" href="module_ajax-axios-symfony.html" title="L'Ajax avec Axios et Symfony">
  <meta name="author" content>
  <meta name="keywords" content>
  <meta name="date" content>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="../lib-md/w_scCodeMgr/scCodeMgr.css">
  <link rel="stylesheet" type="text/css" href="../lib-md/w_scImgMgr/scImgMgr.css">
  <script type="text/JavaScript">
/*0*/ var scServices = {id:"knfsriq1"};
/*1*/ window.scLoadParams = {destUri:"/co/recuperation-asynchrone-donnee.html", pathToRoot:"../"};
</script>
  <script type="text/JavaScript" src="../lib-sc/scCoLib.js"></script>
  <script type="text/JavaScript" src="../lib-sc/scPaLib.js"></script>
  <script type="text/JavaScript" src="../lib-sc/scSiLib.js"></script>
  <script type="text/JavaScript" src="../lib-sc/scTiLib.js"></script>
  <script type="text/JavaScript" src="../lib-sc/scTooltipMgr.js"></script>
  <script type="text/JavaScript" src="../lib-sc/scMapMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/s_assmnt.js"></script>
  <script type="text/JavaScript" src="../lib-sc/scDragMgr.js"></script>
  <script type="text/JavaScript" src="../lib-sc/scDynUiMgr.js"></script>
  <script type="text/JavaScript" src="../lib-sc/scAssmntMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_studiMgr/jquery-1.11.3.min.js"></script>
  <script type="text/JavaScript" src="../lib-md/s_scSearch/scSearch.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_tplMgr/tplMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_mathjax/mathjaxMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_scCodeMgr/scCodeMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_outMgr/outMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_scMediaMgr/scMediaMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_scImgMgr/scImgMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_searchMgr/searchMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_jwplayerMgr/jwplayerMgr.js"></script>
  <script type="text/JavaScript" src="../lib-md/w_studiMgr/studiMgr.js"></script>
  <script type="text/JavaScript">

/*0*/ try{if(window.opener && window.opener.scServices && window.opener.scServices.id == scServices.id) scServices = window.opener.scServices; else if(window.parent && window.parent.scServices && window.parent.scServices.id == scServices.id) scServices = window.parent.scServices;}catch(e){}
scCodeMgr.registerCode("des:div.code");

scImgMgr.registerAdaptedImage("ide:content/des:img");

scImgMgr.registerGallery("des:div.galFra");

scImgMgr.registerSvg("des:svg");
scImgMgr.registerZoom("des:a.svgZoom",{type:"svg",svgMax:1,toolbar:1,titlePath:"par:/nsi:/des:span.capTi"});

scImgMgr.registerZoom("des:a.imgZoom",{toolbar:1,mag:1,titlePath:"par:/nsi:/des:span.capTi"});

</script>
  <link type="text/css" rel="stylesheet" href="../skin/css/main.css" media="all">
  <link type="text/css" rel="stylesheet" href="../skin/css/skin.css" media="all">
  <link type="text/css" rel="stylesheet" href="../skin/css/print.css" media="print">
  <script src="https://cdn.jwplayer.com/libraries/DyAyCxUH.js"></script>
  <script>jwplayer.key="U+hpi4mMOTCDfyWL3FjgwMi/QSkehLvVr4cukDDoslCcpV31";</script>
  <script type="text/JavaScript">
outMgr.declareOutline("module_ajax-axios-symfony.txt");
	</script>
  <script type="text/JavaScript">searchMgr.declareIndex("index.txt");
</script> </head>
 <body class="default module expUc">
  <div id="root"><header id="header" role="banner"><a class="btnZen" role="button" href="#" target="_self" title="Restaurer l'interface par d&eacute;faut." onclick="tplMgr.sToggleZen();return false;"><span>Restaurer</span></a><h1><span>L'Ajax avec Axios et Symfony</span></h1><nav role="navigation"><ul id="accessibility"><li class="waiContent"><a href="#content"><span>contenu</span></a></li><li class="waiMenu"><a href="#menu"><span>menu</span></a></li><li class="waiNav"><a href="#navigation"><span>navigation</span></a></li><li class="waiTools"><a href="#tools"><span>outils</span></a></li></ul></nav></header><main id="main" role="main"><div id="document"><div id="content" tabindex="-1"><div class="scroller"><hr class="hidden"><section class="hBk article expUc"><h2 class="hBk_ti"><span>R&eacute;cup&eacute;ration asynchrone des donn&eacute;es</span></h2><div class="hBk_co "><div class="iBk info"><div class="iBk_co "><div class="rBk "><p><strong class="txt_emp_is ">Dur&eacute;e</strong>&nbsp;: 2&nbsp;h</p><p><strong class="txt_emp_is ">Environnement de travail</strong>&nbsp;: visual Studio Code (ou tout autre &eacute;diteur de texte), PHP</p><p><strong class="txt_emp_is ">Pr&eacute;requis</strong>&nbsp;: PHP, Twig, JavaScript, DOM, Doctrine, bundle <strong class="txt_emp_is ">Maker</strong>, symfony, fixtures</p></div></div></div><div class="iBk info"><div class="iBk_co "><div class="rBk res"><figure role="group" class="resInFlow remoteVideo"><div class="resInFlow_co "><div class="jwplayer" data-media-id="StudiFr/An0gbhuQ"></div></div></figure></div></div></div><div class="context pBk"><h3 class="context_ti pBk_ti"><span><i class="type"><span>Contexte</span></i><span class="hidden"> : </span><span class="title"></span></span></h3><div class="context_co pBk_co"><div class="rBk "><p>Le Web moderne &eacute;vite au maximum les rechargements de page que peuvent occasionner les &eacute;changes entre le client et le serveur. Le but &eacute;tant de rendre les sites web plus dynamiques, attractifs et rapides &agrave; consulter.</p></div><div class="rBk "><p>L'interaction entre l'utilisateur et le site a ainsi un impact direct sur le <i class="txt_spec_is ">Document Object Model</i> (ou DOM). Dans le cas de la soumission d'un formulaire, par exemple, l'impact est &eacute;galement propag&eacute; au serveur.</p></div><div class="rBk "><p>C'est donc dans ce cas de figure qu'on fera appel &agrave; l'AJAX. Il ne s'agit ni d'un langage, ni d'une technologie, mais bien d'un concept consistant &agrave; faire communiquer le client et le serveur de mani&egrave;re asynchrone, afin d'&eacute;viter les rechargements de page.</p></div><div class="rBk "><p>En d'autres termes il s'agit d'un ensemble de technologies qui permet la mise &agrave; jour du contenu d'une page Web d'une mani&egrave;re rapide et sans chargement complet de celle-ci. Ces technologies sont&nbsp;:</p></div><div class="rBk "><ul class="txt_il "><li class="txt_ili "><p>Javascript et DOM pour le traitement,</p></li><li class="txt_ili "><p>XML ou JSON pour l'extraction des donn&eacute;es (le contenu &agrave; afficher),</p></li><li class="txt_ili "><p>HTML et CSS pour la pr&eacute;sentation.</p></li></ul></div></div></div><div class="iBk info"><div class="iBk_co "><div class="rBk res"><figure role="group" class="resInFlow remoteVideo"><div class="resInFlow_co "><div class="jwplayer" data-media-id="StudiFr/PaocvciW"></div></div></figure></div></div></div><div class="iBk info"><h3 class="iBk_ti"><span>Objectifs</span></h3><div class="iBk_co "><div class="rBk "><ul class="txt_il "><li class="txt_ili "><p>D&eacute;couvrir l'asynchrone</p></li><li class="txt_ili "><p>D&eacute;couvrir l'AJAX</p></li><li class="txt_ili "><p>D&eacute;couvrir Axios au sein d'un projet Symfony</p></li><li class="txt_ili "><p>R&eacute;cup&eacute;rer des donn&eacute;es de mani&egrave;re asynchrone</p></li></ul></div></div></div><div class="iBk info"><h3 class="iBk_ti"><span>Mise en situation</span></h3><div class="iBk_co "><div class="rBk "><p>Nous l'avons &eacute;voqu&eacute; pr&eacute;c&eacute;demment, la r&eacute;cup&eacute;ration de donn&eacute;es distantes sans rechargement de la page consult&eacute;e rend l'exp&eacute;rience utilisateur plus agr&eacute;able et la visite du site plus fluide.</p></div><div class="rBk "><p>Pour proposer une telle exp&eacute;rience dans nos sites et applications web, il faut entreprendre plusieurs &eacute;tapes&nbsp;:</p></div><div class="rBk "><ul class="txt_il "><li class="txt_ili "><p>L'utilisateur interagit avec un &eacute;l&eacute;ment du DOM (un bouton, par exemple),</p></li><li class="txt_ili "><p>Cet &eacute;v&eacute;nement d&eacute;clenche l'envoi de la requ&ecirc;te vers le serveur HTTP,</p></li><li class="txt_ili "><p>Le serveur traite &agrave; son tour la requ&ecirc;te re&ccedil;ue,</p></li><li class="txt_ili "><p>Le client re&ccedil;oit la r&eacute;ponse ainsi trait&eacute;e.</p></li></ul></div><div class="rBk "><p>Voici, pour illustrer le propos, un sch&eacute;ma issu de <a class="op_txt_ul" target="_blank" href="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Ajax-modell-fr.svg/1024px-Ajax-modell-fr.svg.png" rel="noopener" title="Wikip&eacute;dia (nouvelle fen&ecirc;tre)"><span>Wikip&eacute;dia</span></a>&nbsp;:</p></div><div class="rBk res"><figure role="group" class="resInFlow png"><div class="resInFlow_co "><img src="../res/schemapartie1.png" width="630" height="601" alt></div></figure></div></div></div><div class="iBk info"><div class="iBk_co "><div class="rBk "><p>L'AJAX (pour <i class="txt_spec_is ">Asynchronous JavaScript And XML</i>) est un concept utile au Web moderne. Il permet d'envoyer et de recevoir des donn&eacute;es depuis une page web sans avoir &agrave; la recharger et ce, de mani&egrave;re <strong class="txt_emp_is ">asynchrone</strong>.</p></div><div class="rBk "><p>Pour comprendre l'asynchrone, nous allons pratiquer autour d'un exemple simple. Imaginons un site d'actualit&eacute;s permettant &agrave; ses utilisateurs connect&eacute;s d'aimer ou non certains des articles publi&eacute;s.</p></div><div class="rBk "><p>Bien entendu, nous avons d&eacute;j&agrave; les cartes en main pour produire ce genre de site, mais nous rencontrerions des latences dans le chargement des donn&eacute;es.</p></div><div class="rBk "><p>C'est pourquoi nous allons mettre en place certaines fonctionnalit&eacute;s de mani&egrave;re asynchrone afin d'offrir une exp&eacute;rience utilisateur plus agr&eacute;able et fluide.</p></div><div class="rBk "><p>Avant de nous int&eacute;resser davantage &agrave; la partie concernant les articles publi&eacute;s et la fonctionnalit&eacute; permettant d'en aimer certains, nous allons mettre en plus un syst&egrave;me asynchrone tr&egrave;s simple, puisqu'il permet d'afficher ou masquer les adresses e-mail des utilisateurs du site.</p></div></div></div><div class="method pBk"><h3 class="method_ti pBk_ti"><span><i class="type"><span>M&eacute;thode</span></i><span class="hidden"> : </span><span class="title"></span></span></h3><div class="method_co pBk_co"><div class="rBk "><p>Pour mettre en place cette petite fonctionnalit&eacute;, voici une entit&eacute; <code class="txt_code_is ">User</code> cr&eacute;&eacute;e &agrave; l'aide du bundle <strong class="txt_emp_is ">Maker</strong>. Symfony Maker vous aide &agrave; cr&eacute;er des commandes vides, des contr&ocirc;leurs, des classes de formulaire, des tests et plus encore. Un utilisateur est identifi&eacute; par un e-mail et un mot de passe pour qu'il puisse se connecter au site web.</p></div><div class="rBk "><p>Pour formater correctement les donn&eacute;es avant de les envoyer au client JavaScript, on a ajout&eacute; une m&eacute;thode tr&egrave;s simple &agrave; la classe <code class="txt_code_is ">User</code>.</p></div><div class="rBk listing"><div><div class="code"><div class="code-form "><div class="CodeMirror-static cm-s-default" data-lang="text/x-php"><div class="CodeMirror-code"><div class="CodeMirror-line"><div class="CodeMirror-linenumber">1</div><pre><span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">toArray</span>() {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">2</div><pre>        <span class="cm-keyword">return</span> [</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">3</div><pre>            <span class="cm-string">&quot;id&quot;</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getId</span>(),</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">4</div><pre>            <span class="cm-string">&quot;email&quot;</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getEmail</span>(),</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">5</div><pre>        ];</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">6</div><pre>    }</pre></div></div></div></div><pre class="code-raw noIndex " style="display:none;">public function toArray() {
        return [
            &quot;id&quot; =&gt; $this-&gt;getId(),
            &quot;email&quot; =&gt; $this-&gt;getEmail(),
        ];
    }</pre></div></div></div></div></div><div class="method pBk"><h3 class="method_ti pBk_ti"><span><i class="type"><span>M&eacute;thode</span></i><span class="hidden"> : </span><span class="title"></span></span></h3><div class="method_co pBk_co"><div class="rBk "><p>Comme son nom l'indique, la m&eacute;thode <code class="txt_code_is ">toArray()</code> va transformer l'objet PHP depuis lequel elle est appel&eacute;e en tableau associatif contenant toutes les informations que l'on a besoin de faire passer au client&nbsp;: l'<code class="txt_code_is ">id</code> et l'adresse e-mail de l'utilisateur.</p></div><div class="rBk "><p>Nous avons &eacute;galement mis en place un minimum de s&eacute;curit&eacute; &agrave; l'aide d'un formulaire de connexion basique.</p></div><div class="rBk "><p>Plus int&eacute;ressant maintenant, voyons comment le contr&ocirc;leur <code class="txt_code_is ">UserController</code> a &eacute;t&eacute; construit.</p></div><div class="rBk listing"><div><div class="code"><div class="code-form "><div class="CodeMirror-static cm-s-default" data-lang="text/x-php"><div class="CodeMirror-code"><div class="CodeMirror-line"><div class="CodeMirror-linenumber">1</div><pre><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">2</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">3</div><pre><span class="cm-keyword">namespace</span> <span class="cm-def">App\Controller</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">4</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">5</div><pre><span class="cm-keyword">use</span> <span class="cm-variable">App\Repository\UserRepository</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">6</div><pre><span class="cm-keyword">use</span> <span class="cm-variable">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">7</div><pre><span class="cm-keyword">use</span> <span class="cm-variable">Symfony\Component\Routing\Annotation\Route</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">8</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">9</div><pre><span class="cm-keyword">class</span> <span class="cm-def">UserController</span> <span class="cm-keyword">extends</span> <span class="cm-variable">AbstractController</span> {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">10</div><pre>    <span class="cm-comment">/**</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">11</div><pre>     <span class="cm-comment">* @Route(&quot;/users&quot;, name=&quot;read_users&quot;)</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">12</div><pre>     <span class="cm-comment">*/</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">13</div><pre>    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">read</span>(<span class="cm-variable">UserRepository</span> <span class="cm-variable-2">$userRepository</span>) {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">14</div><pre>        <span class="cm-variable-2">$users</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$userRepository</span><span class="cm-operator">-&gt;</span><span class="cm-variable">findAll</span>();</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">15</div><pre>        <span class="cm-variable-2">$arrayOfUsers</span> <span class="cm-operator">=</span> [];</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">16</div><pre>        <span class="cm-keyword">foreach</span> (<span class="cm-variable-2">$users</span> <span class="cm-keyword">as</span> <span class="cm-variable-2">$user</span>) {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">17</div><pre>            <span class="cm-variable-2">$arrayOfUsers</span>[] <span class="cm-operator">=</span> <span class="cm-variable-2">$user</span><span class="cm-operator">-&gt;</span><span class="cm-variable">toArray</span>();</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">18</div><pre>        }</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">19</div><pre>        <span class="cm-keyword">return</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">json</span>(<span class="cm-variable-2">$arrayOfUsers</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">20</div><pre>    }</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">21</div><pre>}</pre></div></div></div></div><pre class="code-raw noIndex " style="display:none;">&lt;?php

namespace App\Controller;

use App\Repository\UserRepository;
use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\Routing\Annotation\Route;

class UserController extends AbstractController {
    /**
     * @Route(&quot;/users&quot;, name=&quot;read_users&quot;)
     */
    public function read(UserRepository $userRepository) {
        $users = $userRepository-&gt;findAll();
        $arrayOfUsers = [];
        foreach ($users as $user) {
            $arrayOfUsers[] = $user-&gt;toArray();
        }
        return $this-&gt;json($arrayOfUsers);
    }
}</pre></div></div></div></div></div><div class="iBk info"><div class="iBk_co "><div class="rBk "><p>C'est &agrave; ce moment que l'on entre dans le c&oelig;ur du sujet, puisque l'on va configurer les donn&eacute;es re&ccedil;ues afin que notre client JavaScript les re&ccedil;oive au format JSON.</p></div><div class="rBk "><p>Pour ce faire, nous r&eacute;cup&eacute;rons d'abord tous les utilisateurs en base de donn&eacute;es (vous pouvez les g&eacute;n&eacute;rer &agrave; l'aide de fixtures, cf <i class="txt_spec_is ">Doctrine Fixture</i>), avant de les stocker un &agrave; un dans un tableau, non pas sous la forme d'un objet PHP, mais d'un tableau associatif g&eacute;n&eacute;r&eacute; &agrave; l'aide de la m&eacute;thode <code class="txt_code_is ">toArray()</code>, pr&eacute;alablement ajout&eacute;e &agrave; l'entit&eacute; <code class="txt_code_is ">User</code>.</p></div><div class="rBk "><p>Une fois tous les utilisateurs stock&eacute;s dans le tableau, nous le passons en argument de la m&eacute;thode <code class="txt_code_is ">json()</code>, issue de la classe <code class="txt_code_is ">AbstractController</code> et permettant de renvoyer une r&eacute;ponse au format JSON.</p></div><div class="rBk "><p>De cette mani&egrave;re, nous pourrons r&eacute;aliser un appel asynchrone depuis notre client sur la route <code class="txt_code_is ">/users</code> pour r&eacute;cup&eacute;rer ces donn&eacute;es.</p></div><div class="rBk "><p>Int&eacute;ressons-nous maintenant &agrave; l'aspect front-end de notre application. Pour cela, nous avons cr&eacute;&eacute; un contr&ocirc;leur <code class="txt_code_is ">PostController</code> basique, qui nous permettra d'afficher les diff&eacute;rents articles publi&eacute;s directement depuis la route racine de l'application. En l'occurrence, le template Twig affichera &eacute;galement un bouton &laquo;&nbsp;<i class="txt_spec_is "><strong class="txt_emp_is ">Afficher les utilisateurs</strong></i>&nbsp;&raquo; pour afficher la liste des adresses e-mail des utilisateurs stock&eacute;s en base de donn&eacute;es de mani&egrave;re asynchrone.</p></div><div class="rBk "><p>Voyons &agrave; quoi ressemble le contr&ocirc;leur <code class="txt_code_is ">PostController</code>.</p></div><div class="rBk listing"><div><div class="code"><div class="code-form "><div class="CodeMirror-static cm-s-default" data-lang="text/x-php"><div class="CodeMirror-code"><div class="CodeMirror-line"><div class="CodeMirror-linenumber">1</div><pre><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">2</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">3</div><pre><span class="cm-keyword">namespace</span> <span class="cm-def">App\Controller</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">4</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">5</div><pre><span class="cm-keyword">use</span> <span class="cm-variable">App\Repository\PostRepository</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">6</div><pre><span class="cm-keyword">use</span> <span class="cm-variable">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">7</div><pre><span class="cm-keyword">use</span> <span class="cm-variable">Symfony\Component\Routing\Annotation\Route</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">8</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">9</div><pre><span class="cm-keyword">class</span> <span class="cm-def">PostController</span> <span class="cm-keyword">extends</span> <span class="cm-variable">AbstractController</span> {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">10</div><pre>    <span class="cm-comment">/**</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">11</div><pre>     <span class="cm-comment">* @Route(&quot;/&quot;, name=&quot;posts&quot;)</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">12</div><pre>     <span class="cm-comment">*/</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">13</div><pre>    <span class="cm-keyword">public</span> <span class="cm-keyword">function</span> <span class="cm-def">index</span>(<span class="cm-variable">PostRepository</span> <span class="cm-variable-2">$postRepository</span>) {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">14</div><pre>        <span class="cm-keyword">return</span> <span class="cm-variable-2">$this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">render</span>(<span class="cm-string">&quot;post/index.html.twig&quot;</span>, [</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">15</div><pre>           <span class="cm-string">&quot;posts&quot;</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$postRepository</span><span class="cm-operator">-&gt;</span><span class="cm-variable">findAll</span>()</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">16</div><pre>        ]);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">17</div><pre>    }</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">18</div><pre>}</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">19</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">20</div><pre><span class="cm-operator">?&gt;</span></pre></div></div></div></div><pre class="code-raw noIndex " style="display:none;">&lt;?php

namespace App\Controller;

use App\Repository\PostRepository;
use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\Routing\Annotation\Route;

class PostController extends AbstractController {
    /**
     * @Route(&quot;/&quot;, name=&quot;posts&quot;)
     */
    public function index(PostRepository $postRepository) {
        return $this-&gt;render(&quot;post/index.html.twig&quot;, [
           &quot;posts&quot; =&gt; $postRepository-&gt;findAll()
        ]);
    }
}

?&gt;</pre></div></div></div></div></div><div class="iBk info"><div class="iBk_co "><div class="rBk "><p>De mani&egrave;re tout &agrave; fait basique, ce contr&ocirc;leur se contente de renvoyer tous les articles stock&eacute;s en base de donn&eacute;es au template <code class="txt_code_is ">index.html.twig</code>, situ&eacute; dans le dossier <code class="txt_code_is ">./templates/post</code>. Comme convenu, la route racine de notre application lui est associ&eacute;e.</p></div><div class="rBk "><p>Int&eacute;ressons-nous enfin au fichier <code class="txt_code_is ">index.html.twig</code> contenant la logique asynchrone de la fonctionnalit&eacute; que nous souhaitons impl&eacute;menter.</p></div><div class="rBk listing"><div><div class="code"><div class="code-form "><div class="CodeMirror-static cm-s-default" data-lang="text/x-php"><div class="CodeMirror-code"><div class="CodeMirror-line"><div class="CodeMirror-linenumber">1</div><pre>{<span class="cm-operator">%</span> <span class="cm-keyword">extends</span> <span class="cm-string">'base.html.twig'</span> <span class="cm-operator">%</span>}</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">2</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">3</div><pre>{<span class="cm-operator">%</span> <span class="cm-variable">block</span> <span class="cm-variable">body</span> <span class="cm-operator">%</span>}</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">4</div><pre>    <span class="cm-operator">&lt;</span><span class="cm-variable">h2</span><span class="cm-operator">&gt;</span><span class="cm-variable">Mes</span> <span class="cm-variable">publications</span><span class="cm-operator">&lt;/</span><span class="cm-variable">h2</span><span class="cm-operator">&gt;</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">5</div><pre>    <span class="cm-operator">&lt;</span><span class="cm-variable">a</span> <span class="cm-variable">href</span><span class="cm-operator">=</span><span class="cm-string">&quot;/users&quot;</span> <span class="cm-keyword">class</span><span class="cm-operator">=</span><span class="cm-string">&quot;btn btn-primary js-users&quot;</span><span class="cm-operator">&gt;</span><span class="cm-variable">Afficher</span> <span class="cm-variable">les</span> <span class="cm-variable">utilisateurs</span><span class="cm-operator">&lt;/</span><span class="cm-variable">a</span><span class="cm-operator">&gt;</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">6</div><pre>    <span class="cm-operator">&lt;</span><span class="cm-variable">div</span> <span class="cm-keyword">class</span><span class="cm-operator">=</span><span class="cm-string">&quot;users&quot;</span><span class="cm-operator">&gt;&lt;/</span><span class="cm-variable">div</span><span class="cm-operator">&gt;</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">7</div><pre>    <span class="cm-operator">&lt;</span><span class="cm-variable">div</span> <span class="cm-keyword">class</span><span class="cm-operator">=</span><span class="cm-string">&quot;row&quot;</span><span class="cm-operator">&gt;</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">8</div><pre>        {<span class="cm-operator">%</span> <span class="cm-keyword">for</span> <span class="cm-variable">post</span> <span class="cm-variable">in</span> <span class="cm-variable">posts</span> <span class="cm-operator">%</span>}</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">9</div><pre>            <span class="cm-operator">&lt;</span><span class="cm-variable">div</span> <span class="cm-keyword">class</span><span class="cm-operator">=</span><span class="cm-string">&quot;col-3 mb-3 card&quot;</span> <span class="cm-variable">style</span><span class="cm-operator">=</span><span class="cm-string">&quot;width: 18rem;&quot;</span><span class="cm-operator">&gt;</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">10</div><pre>                <span class="cm-operator">&lt;</span><span class="cm-variable">div</span> <span class="cm-keyword">class</span><span class="cm-operator">=</span><span class="cm-string">&quot;card-body&quot;</span><span class="cm-operator">&gt;</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">11</div><pre>                    <span class="cm-operator">&lt;</span><span class="cm-variable">h5</span> <span class="cm-keyword">class</span><span class="cm-operator">=</span><span class="cm-string">&quot;card-title&quot;</span><span class="cm-operator">&gt;</span>{{ <span class="cm-variable">post</span>.<span class="cm-variable">title</span> }}<span class="cm-operator">&lt;/</span><span class="cm-variable">h5</span><span class="cm-operator">&gt;</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">12</div><pre>                    <span class="cm-operator">&lt;</span><span class="cm-variable">p</span> <span class="cm-keyword">class</span><span class="cm-operator">=</span><span class="cm-string">&quot;card-text&quot;</span><span class="cm-operator">&gt;</span>{{ <span class="cm-variable">post</span>.<span class="cm-variable">content</span> }}<span class="cm-operator">&lt;/</span><span class="cm-variable">p</span><span class="cm-operator">&gt;</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">13</div><pre>                <span class="cm-operator">&lt;/</span><span class="cm-variable">div</span><span class="cm-operator">&gt;</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">14</div><pre>            <span class="cm-operator">&lt;/</span><span class="cm-variable">div</span><span class="cm-operator">&gt;</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">15</div><pre>        {<span class="cm-operator">%</span> <span class="cm-keyword">else</span> <span class="cm-operator">%</span>}</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">16</div><pre>            <span class="cm-operator">&lt;</span><span class="cm-variable">b</span><span class="cm-operator">&gt;</span><span class="cm-variable">Aucune</span> <span class="cm-variable">publication</span><span class="cm-operator">&lt;/</span><span class="cm-variable">b</span><span class="cm-operator">&gt;</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">17</div><pre>        {<span class="cm-operator">%</span> <span class="cm-keyword">endfor</span> <span class="cm-operator">%</span>}</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">18</div><pre>    <span class="cm-operator">&lt;/</span><span class="cm-variable">div</span><span class="cm-operator">&gt;</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">19</div><pre>{<span class="cm-operator">%</span> <span class="cm-variable">endblock</span> <span class="cm-operator">%</span>}</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">20</div><pre></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">21</div><pre>{<span class="cm-operator">%</span> <span class="cm-variable">block</span> <span class="cm-variable">javascripts</span> <span class="cm-operator">%</span>}</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">22</div><pre>    <span class="cm-operator">&lt;</span><span class="cm-variable">script</span> <span class="cm-variable">src</span><span class="cm-operator">=</span><span class="cm-string">&quot;https://unpkg.com/axios/dist/axios.min.js&quot;</span><span class="cm-operator">&gt;&lt;/</span><span class="cm-variable">script</span><span class="cm-operator">&gt;</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">23</div><pre>    <span class="cm-operator">&lt;</span><span class="cm-variable">script</span><span class="cm-operator">&gt;</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">24</div><pre>        <span class="cm-variable">window</span>.<span class="cm-variable">addEventListener</span>(<span class="cm-string">&quot;load&quot;</span>, <span class="cm-keyword">function</span>(<span class="cm-variable">event</span>) {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">25</div><pre>            <span class="cm-variable">document</span>.<span class="cm-variable">querySelector</span>(<span class="cm-string">&quot;a.js-users&quot;</span>).<span class="cm-variable">addEventListener</span>(<span class="cm-string">&quot;click&quot;</span>, <span class="cm-variable">getUsers</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">26</div><pre>        });</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">27</div><pre>        </pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">28</div><pre>        <span class="cm-keyword">function</span> <span class="cm-def">getUsers</span> (<span class="cm-variable">event</span>) {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">29</div><pre>            <span class="cm-variable">event</span>.<span class="cm-variable">preventDefault</span>();</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">30</div><pre>            <span class="cm-variable">axios</span>.<span class="cm-variable">get</span>(<span class="cm-variable">this</span>.<span class="cm-variable">href</span>).<span class="cm-variable">then</span>(<span class="cm-variable">response</span> <span class="cm-operator">=&gt;</span> {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">31</div><pre>                <span class="cm-keyword">const</span> <span class="cm-variable">users</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-variable">querySelector</span>(<span class="cm-string">&quot;div.users&quot;</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">32</div><pre>                <span class="cm-keyword">if</span>(<span class="cm-variable">this</span>.<span class="cm-variable">classList</span>.<span class="cm-variable">contains</span>(<span class="cm-string">&quot;btn-primary&quot;</span>)) {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">33</div><pre>                    <span class="cm-variable">response</span>.<span class="cm-variable">data</span>.<span class="cm-variable">forEach</span>(<span class="cm-variable">user</span> <span class="cm-operator">=&gt;</span> {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">34</div><pre>                        <span class="cm-keyword">const</span> <span class="cm-variable">node</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-variable">createElement</span>(<span class="cm-string">&quot;li&quot;</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">35</div><pre>                        <span class="cm-variable">node</span>.<span class="cm-variable">textContent</span> <span class="cm-operator">=</span> <span class="cm-variable">user</span>.<span class="cm-variable">email</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">36</div><pre>                        <span class="cm-variable">users</span>.<span class="cm-variable">appendChild</span>(<span class="cm-variable">node</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">37</div><pre>                    });</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">38</div><pre>                    <span class="cm-variable">this</span>.<span class="cm-variable">classList</span>.<span class="cm-variable">replace</span>(<span class="cm-string">&quot;btn-primary&quot;</span>, <span class="cm-string">&quot;btn-danger&quot;</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">39</div><pre>                    <span class="cm-variable">this</span>.<span class="cm-variable">textContent</span> <span class="cm-operator">=</span> <span class="cm-string">&quot;Masquer les utilisateurs&quot;</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">40</div><pre>                } <span class="cm-keyword">else</span> {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">41</div><pre>                    <span class="cm-variable">users</span>.<span class="cm-variable">innerHTML</span> <span class="cm-operator">=</span> <span class="cm-string">&quot;&quot;</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">42</div><pre>                    <span class="cm-variable">this</span>.<span class="cm-variable">classList</span>.<span class="cm-variable">replace</span>(<span class="cm-string">&quot;btn-danger&quot;</span>, <span class="cm-string">&quot;btn-primary&quot;</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">43</div><pre>                    <span class="cm-variable">this</span>.<span class="cm-variable">textContent</span> <span class="cm-operator">=</span> <span class="cm-string">&quot;Afficher les utilisateurs&quot;</span>;</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">44</div><pre>                }</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">45</div><pre>            }).<span class="cm-keyword">catch</span>(<span class="cm-variable">error</span> <span class="cm-operator">=&gt;</span> {</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">46</div><pre>                <span class="cm-variable">console</span>.<span class="cm-variable">error</span>(<span class="cm-variable">error</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">47</div><pre>                <span class="cm-variable">window</span>.<span class="cm-variable">alert</span>(<span class="cm-string">&quot;Une erreur s'est produite.&quot;</span>);</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">48</div><pre>            });</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">49</div><pre>        }</pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">50</div><pre>    <span class="cm-operator">&lt;/</span><span class="cm-variable">script</span><span class="cm-operator">&gt;</span></pre></div><div class="CodeMirror-line"><div class="CodeMirror-linenumber">51</div><pre>{<span class="cm-operator">%</span> <span class="cm-variable">endblock</span> <span class="cm-operator">%</span>}</pre></div></div></div></div><pre class="code-raw noIndex " style="display:none;">{% extends 'base.html.twig' %}

{% block body %}
    &lt;h2&gt;Mes publications&lt;/h2&gt;
    &lt;a href=&quot;/users&quot; class=&quot;btn btn-primary js-users&quot;&gt;Afficher les utilisateurs&lt;/a&gt;
    &lt;div class=&quot;users&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;row&quot;&gt;
        {% for post in posts %}
            &lt;div class=&quot;col-3 mb-3 card&quot; style=&quot;width: 18rem;&quot;&gt;
                &lt;div class=&quot;card-body&quot;&gt;
                    &lt;h5 class=&quot;card-title&quot;&gt;{{ post.title }}&lt;/h5&gt;
                    &lt;p class=&quot;card-text&quot;&gt;{{ post.content }}&lt;/p&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        {% else %}
            &lt;b&gt;Aucune publication&lt;/b&gt;
        {% endfor %}
    &lt;/div&gt;
{% endblock %}

{% block javascripts %}
    &lt;script src=&quot;https://unpkg.com/axios/dist/axios.min.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
        window.addEventListener(&quot;load&quot;, function(event) {
            document.querySelector(&quot;a.js-users&quot;).addEventListener(&quot;click&quot;, getUsers);
        });
        
        function getUsers (event) {
            event.preventDefault();
            axios.get(this.href).then(response =&gt; {
                const users = document.querySelector(&quot;div.users&quot;);
                if(this.classList.contains(&quot;btn-primary&quot;)) {
                    response.data.forEach(user =&gt; {
                        const node = document.createElement(&quot;li&quot;);
                        node.textContent = user.email;
                        users.appendChild(node);
                    });
                    this.classList.replace(&quot;btn-primary&quot;, &quot;btn-danger&quot;);
                    this.textContent = &quot;Masquer les utilisateurs&quot;;
                } else {
                    users.innerHTML = &quot;&quot;;
                    this.classList.replace(&quot;btn-danger&quot;, &quot;btn-primary&quot;);
                    this.textContent = &quot;Afficher les utilisateurs&quot;;
                }
            }).catch(error =&gt; {
                console.error(error);
                window.alert(&quot;Une erreur s'est produite.&quot;);
            });
        }
    &lt;/script&gt;
{% endblock %}</pre></div></div></div></div></div><div class="iBk info"><div class="iBk_co "><div class="rBk "><p>Je vous l'accorde, le fichier est bien rempli. Prenons le temps de le d&eacute;cortiquer ensemble.</p></div><div class="rBk "><p>Comme dans tout template Twig, nous &eacute;tendons d'abord le fichier <code class="txt_code_is ">base.html.twig</code> afin d'avoir acc&egrave;s aux diff&eacute;rents blocs de structure. Nous ouvrons justement le bloc <code class="txt_code_is ">body</code> afin d'y placer le corps de notre page web.</p></div><div class="rBk "><p>Un titre, puis des cartes stylis&eacute;es &agrave; l'aide de Bootstrap pour afficher les articles stock&eacute;s en base de donn&eacute;es, envoy&eacute;s via le contr&ocirc;leur <code class="txt_code_is ">PostController</code>. Dans le cas o&ugrave; il n'y a pas d'article, on affiche un message simple, mais efficace, en gras&nbsp;: &laquo;&nbsp;<strong class="txt_emp_is "><i class="txt_spec_is ">Aucune publication</i></strong>&nbsp;&raquo;.</p></div><div class="rBk "><p>Voil&agrave; pour la base de ce fichier. Il s'agit l&agrave; d'&eacute;l&eacute;ments que vous connaissez d&eacute;j&agrave;. Int&eacute;ressons-nous maintenant &agrave; de l'in&eacute;dit&nbsp;!</p></div><div class="rBk "><p>Souvenez-vous, nous avons dit que nous souhaitions afficher les adresses e-mail des utilisateurs stock&eacute;s en base de donn&eacute;es de mani&egrave;re asynchrone, et ce d'un simple clic sur un bouton. Nous avons justement mis en place un bouton &laquo;&nbsp;<strong class="txt_emp_is "><i class="txt_spec_is ">Afficher les utilisateurs</i></strong>&nbsp;&raquo; pointant vers l'URL <code class="txt_code_is ">/users</code> pr&eacute;c&eacute;demment configur&eacute;e &agrave; travers le contr&ocirc;leur <code class="txt_code_is ">UserController</code>.</p></div><div class="rBk "><p>Remarquez &eacute;galement que nous lui avons donn&eacute; une classe Bootstrap afin de le styliser, mais &eacute;galement une classe <code class="txt_code_is ">js-users</code> afin de traiter l'&eacute;v&eacute;nement li&eacute; au clic sur ce bouton.</p></div><div class="rBk "><p>Pour ce faire, il nous faut &eacute;crire un peu de JavaScript, ce qui nous m&egrave;ne directement au second bloc du fichier, le bloc <code class="txt_code_is ">javascripts</code>.</p></div><div class="rBk "><p>La premi&egrave;re chose &agrave; entreprendre pour faire de l'AJAX au sein de notre template Twig va &ecirc;tre de charger Axios. Il s'agit d'un client HTTP bas&eacute; sur les promesses JavaScript. Pour rappel, l'objet <code class="txt_code_is ">Promise</code> est utilis&eacute; pour r&eacute;aliser des traitements asynchrones.</p></div><div class="rBk "><p>Pour charger cette technologie, nous utilisons simplement son CDN (pour <i class="txt_spec_is ">Content Delivery Network</i> ou R&eacute;seau de Diffusion de Contenu) r&eacute;f&eacute;renc&eacute; sur le GitHub officiel d'Axios, disponible &agrave; cette adresse&nbsp;: <a class="op_txt_ul" target="_blank" href="https://github.com/axios/axios" rel="noopener" title="axios/axios (nouvelle fen&ecirc;tre)"><span>axios/axios</span></a>.</p></div><div class="rBk "><p>Ce faisant, nous avons d&eacute;sormais acc&egrave;s &agrave; l'objet JavaScript <code class="txt_code_is ">axios</code> permettant de r&eacute;aliser des requ&ecirc;tes de mani&egrave;re asynchrone.</p></div><div class="rBk "><p>Avant cela, nous allons vouloir que la page soit compl&egrave;tement charg&eacute;e avant d'ajouter un &eacute;couteur d'&eacute;v&eacute;nement sur le bouton &laquo;&nbsp;<strong class="txt_emp_is "><i class="txt_spec_is ">Afficher les utilisateurs</i></strong>&nbsp;&raquo;. Pour ce faire, nous utilisons &agrave; deux reprises la m&eacute;thode <code class="txt_code_is ">addEventListener()</code> afin de g&eacute;rer le chargement de la page, puis le bouton qui nous int&eacute;resse que nous r&eacute;cup&eacute;rons tr&egrave;s simplement gr&acirc;ce &agrave; la m&eacute;thode <code class="txt_code_is ">querySelector()</code> associ&eacute;e au s&eacute;lecteur CSS <code class="txt_code_is ">a.js-users</code>, que nous avons param&eacute;tr&eacute; pr&eacute;c&eacute;demment, pass&eacute; en argument.</p></div><div class="rBk "><p>Remarquez l'appel de la fonction <code class="txt_code_is ">getUsers()</code> lorsque l'utilisateur clique sur le bouton. C'est au sein de celle-ci que nous allons r&eacute;aliser notre premier traitement asynchrone.</p></div><div class="rBk "><p>Comme toute fonction appel&eacute;e depuis la m&eacute;thode <code class="txt_code_is ">addEventListener()</code>, elle re&ccedil;oit l'&eacute;v&eacute;nement produit en argument.</p></div><div class="rBk "><p>Au sein de la fonction <code class="txt_code_is ">getUsers()</code>, on utilise directement cet objet afin d'&eacute;viter la redirection vers la route <code class="txt_code_is ">/users</code> que nous avons programm&eacute;e &agrave; travers l'attribut <code class="txt_code_is ">href</code> associ&eacute; au bouton &laquo;&nbsp;<strong class="txt_emp_is "><i class="txt_spec_is ">Afficher les utilisateurs</i></strong>&nbsp;&raquo;. En effet, la m&eacute;thode <code class="txt_code_is ">preventDefault()</code> associ&eacute;e &agrave; un &eacute;v&eacute;nement JavaScript permet d'&eacute;viter tout autre traitement.</p></div><div class="rBk "><p>Il est maintenant question d'utiliser l'objet <code class="txt_code_is ">axios</code> afin de r&eacute;aliser les traitements associ&eacute;s &agrave; la route <code class="txt_code_is ">/users</code> de mani&egrave;re asynchrone. Pour ce faire, Axios propose deux m&eacute;thodes&nbsp;:</p></div><div class="rBk "><ul class="txt_il "><li class="txt_ili "><p>La m&eacute;thode <code class="txt_code_is ">get()</code> permet de requ&ecirc;ter une URL, pass&eacute;e en argument, avec des param&egrave;tres &eacute;ventuels .</p></li><li class="txt_ili "><p>La m&eacute;thode <code class="txt_code_is ">post()</code> permet de requ&ecirc;ter une URL, pass&eacute;e en argument, avec des informations compl&eacute;mentaires &agrave; placer dans le corps de la requ&ecirc;te.</p></li></ul></div><div class="rBk "><p>En l'occurrence, nous souhaitons uniquement requ&ecirc;ter l'URL <code class="txt_code_is ">/users</code>, qui a &eacute;t&eacute; pass&eacute;e en valeur de l'attribut <code class="txt_code_is ">href</code> du bouton cliqu&eacute;. Ainsi, le mot-cl&eacute; <code class="txt_code_is ">this</code> nous permet de r&eacute;cup&eacute;rer cet &eacute;l&eacute;ment HTML, duquel nous r&eacute;cup&eacute;rons la valeur associ&eacute;e &agrave; l'attribut <code class="txt_code_is ">href</code>.</p></div><div class="rBk "><p>En appelant la m&eacute;thode <code class="txt_code_is ">get()</code>, issue de l'objet <code class="txt_code_is ">axios</code>, nous cr&eacute;ons une promesse JavaScript. Nous avons ainsi acc&egrave;s &agrave; la m&eacute;thode <code class="txt_code_is ">then()</code> permettant de r&eacute;aliser des traitements une fois la r&eacute;ponse HTTP re&ccedil;ue.</p></div><div class="rBk "><p>Cet objet est d'ailleurs pass&eacute; en argument de la fonction anonyme que re&ccedil;oit la m&eacute;thode <code class="txt_code_is ">then()</code> afin de la traiter.</p></div><div class="rBk "><p>Souvenez-vous, nous avons fait en sorte que le contr&ocirc;leur associ&eacute; &agrave; la route <code class="txt_code_is ">/users</code> se charge de renvoyer tous les utilisateurs stock&eacute;s en base de donn&eacute;es au format JSON.</p></div><div class="rBk "><p>Ces donn&eacute;es sont d&eacute;sormais accessibles directement depuis l'objet <code class="txt_code_is ">response</code>. Pour en avoir le c&oelig;ur net, vous pouvez afficher l'objet dans la console de votre navigateur web via l'expression <code class="txt_code_is ">console.log(response)</code>.</p></div><div class="rBk res"><figure role="group" class="resInFlow png"><div class="resInFlow_co "><a href="../res/ajax-axios-symfony-image-1.png" class="imgZoom" target="_blank" onclick="scImgMgr.loading(); return false;" title="Cliquez pour agrandir (nouvelle fen&ecirc;tre)"><img src="../res/ajax-axios-symfony-image-1_1.png" width="630" height="55" alt></a></div></figure></div><div class="rBk "><p>Nous d&eacute;couvrons ici plusieurs informations int&eacute;ressantes. Tout d'abord, le code de statut 200&nbsp;renvoy&eacute; par la requ&ecirc;te&nbsp;: tout s'est bien pass&eacute;. Nous retrouvons &eacute;galement l'URL requ&ecirc;t&eacute;e, ainsi que la m&eacute;thode HTTP utilis&eacute;e, le type de donn&eacute;es renvoy&eacute;es, l'en-t&ecirc;te de la r&eacute;ponse, etc.</p></div><div class="rBk "><p>Ce qui nous int&eacute;resse se situe dans la propri&eacute;t&eacute; <code class="txt_code_is ">data</code> de l'objet <code class="txt_code_is ">response</code>. Il s'agit bel et bien du tableau de donn&eacute;es JSON que nous avons renvoy&eacute; depuis le contr&ocirc;leur <code class="txt_code_is ">UserController</code>.</p></div><div class="rBk "><p>Il ne nous reste plus qu'&agrave; parcourir ce tableau de donn&eacute;es afin de les traiter avec le JavaScript n&eacute;cessaire.</p></div><div class="rBk "><p>Tous les traitements r&eacute;alis&eacute;s ici ont un impact direct sur le DOM de la page. Nous r&eacute;cup&eacute;rons d'abord la <code class="txt_code_is ">div</code> vide associ&eacute;e &agrave; la classe CSS <code class="txt_code_is ">users</code>, pr&eacute;alablement cr&eacute;&eacute;e, puis nous v&eacute;rifions que le bouton sur lequel nous avons cliqu&eacute; est associ&eacute; &agrave; la classe <code class="txt_code_is ">btn-primary</code>.</p></div><div class="rBk "><p>Si c'est le cas, nous parcourons le tableau de donn&eacute;es situ&eacute; dans la propri&eacute;t&eacute; <code class="txt_code_is ">data</code> de l'objet <code class="txt_code_is ">response</code>, afin d'ins&eacute;rer chacune des adresses e-mail des utilisateurs en &eacute;l&eacute;ments d'une liste HTML non ordonn&eacute;e.</p></div><div class="rBk "><p>Enfin, nous rempla&ccedil;ons le texte du bouton &laquo;&nbsp;<strong class="txt_emp_is "><i class="txt_spec_is ">Afficher les utilisateurs</i></strong>&nbsp;&raquo;, par &laquo;&nbsp;<strong class="txt_emp_is "><i class="txt_spec_is ">Masquer les utilisateurs</i></strong>&nbsp;&raquo;. Nous en profitons &eacute;galement pour remplacer la classe <code class="txt_code_is ">btn-primary</code> par <code class="txt_code_is ">btn-danger</code> pour faire passer le bouton Bootstrap du bleu au rouge.</p></div><div class="rBk "><p>Dans le cas o&ugrave; la classe <code class="txt_code_is ">btn-danger</code> est d&eacute;j&agrave; attribu&eacute;e au bouton cliqu&eacute;, il nous faut retirer les enfants de la div <code class="txt_code_is ">users</code> et revenir vers le texte et le style pr&eacute;c&eacute;dents du bouton.</p></div></div></div><div class="remark pBk"><h3 class="remark_ti pBk_ti"><span><i class="type"><span>Remarque</span></i><span class="hidden"> : </span><span class="title"></span></span></h3><div class="remark_co pBk_co"><div class="rBk "><p>Quand nous parlons d'asynchrone et de <code class="txt_code_is ">Promise</code> JavaScript, nous ne sommes pas &agrave; l'abri de rencontrer une erreur li&eacute;e au serveur, au manque de connexion, ou directement au client.</p></div><div class="rBk "><p>Pour g&eacute;rer correctement ce genre de probl&egrave;me et ainsi pr&eacute;venir l'utilisateur du probl&egrave;me rencontr&eacute;, nous avons acc&egrave;s &agrave; la m&eacute;thode <code class="txt_code_is ">catch()</code>, prenant en argument une fonction anonyme recevant l'erreur rencontr&eacute;e en param&egrave;tre. Nous pouvons ensuite traiter l'erreur comme nous le souhaitons. En l'occurrence, nous choisissons de l'afficher en rouge en console et de pr&eacute;venir l'utilisateur &agrave; l'aide d'une simple modale d'alerte.</p></div><div class="rBk res"><figure role="group" class="resInFlow png"><div class="resInFlow_co "><img src="../res/ajax-axios-symfony-image-2.png" width="484" height="34" alt></div></figure></div><div class="rBk "><p>Ici, nous avons volontairement choisi de faire pointer la requ&ecirc;te asynchrone vers une URL qui n'existe pas dans notre application. L'erreur nous signale que l'on est face &agrave; un code de statut 404. On pourrait ainsi imaginer un traitement simple permettant de signaler &agrave; l'utilisateur qu'il se trouve sur une URL inexistante, par exemple.</p></div></div></div><div class="syntax pBk"><h3 class="syntax_ti pBk_ti"><span><i class="type"><span>Syntaxe</span></i><span class="hidden"> : </span><span class="title">&Agrave; retenir</span></span></h3><div class="syntax_co pBk_co"><div class="rBk "><p>Dans cette partie du cours, plusieurs &eacute;l&eacute;ments m&eacute;ritent une attention toute particuli&egrave;re de votre part.</p></div><div class="rBk "><p>Cette information est disponible depuis le <a class="op_txt_ul" target="_blank" href="https://github.com/axios/axios" rel="noopener" title="GitHub officiel d'Axios (nouvelle fen&ecirc;tre)"><span>GitHub officiel d'Axios</span></a>, mais il ne fait pas de mal de rappeler son CDN&nbsp;: <code class="txt_code_is ">&lt;script src=&quot;https://unpkg.com/axio /dist/axios.min.js&quot;&gt;&lt;/script&gt;</code>.</p></div><div class="rBk "><p>Il suffit de l'int&eacute;grer dans un un template Twig pour pouvoir utiliser l'objet JavaScript <code class="txt_code_is ">axios</code> permettant de r&eacute;aliser des traitements de mani&egrave;re asynchrone, notamment gr&acirc;ce &agrave; sa m&eacute;thode <code class="txt_code_is ">get()</code> qui, en lui passant une URL en argument, permet de la requ&ecirc;ter &agrave; l'aide d'une <code class="txt_code_is ">Promise</code> JavaScript.</p></div><div class="rBk "><p>L'asynchrone sous-entend que nous ne savons pas n&eacute;cessairement quand  nous allons recevoir les donn&eacute;es souhait&eacute;es. Aussi, la m&eacute;thode <code class="txt_code_is ">then()</code> va nous permettre de r&eacute;aliser les traitements qui ne doivent &ecirc;tre faits sur la r&eacute;ponse HTTP qu'une fois re&ccedil;ue.</p></div><div class="rBk "><p>Cette r&eacute;ponse HTTP est justement contenue dans un objet <code class="txt_code_is ">response</code> pass&eacute; en argument d'une fonction anonyme que prend la m&eacute;thode <code class="txt_code_is ">then()</code>. &Agrave; vous de traiter les &eacute;l&eacute;ments contenus dans la r&eacute;ponse pour combler vos attentes. Retenez que vous pouvez afficher cet objet en console de votre navigateur web &agrave; l'aide de l'expression <code class="txt_code_is ">console.log(response)</code>.</p></div><div class="rBk "><p>Enfin, la m&eacute;thode <code class="txt_code_is ">catch()</code>, &agrave; faire suivre du bloc <code class="txt_code_is ">then()</code>, permet de stopper l'ex&eacute;cution du script pour traiter correctement les erreurs rencontr&eacute;es. Il est ainsi facile de pr&eacute;venir l'utilisateur de ce qui ne va pas gr&acirc;ce &agrave; l'objet JavaScript <code class="txt_code_is ">error</code>, transmis en argument de la fonction anonyme re&ccedil;ue par la m&eacute;thode <code class="txt_code_is ">catch()</code>.</p></div></div></div><div class="iBk info"><div class="iBk_co "><div class="rBk res"><figure role="group" class="resInFlow remoteVideo"><div class="resInFlow_co "><div class="jwplayer" data-media-id="StudiFr/H7Me6wKq"></div></div></figure></div></div></div></div></section></div></div></div><div id="toolbox"><nav id="menu" class="pageSelector hidden" role="navigation" tabindex="-1" aria-label="menu principal"><hr class="hidden"><ul class="mnu static" data-totalPages="8"><li class="sel_yes anc_no type_l  dpt_0 expUc"><div class="lbl type_l" id="recuperation-asynchrone-donnee.html"><span class="item"><span>R&eacute;cup&eacute;ration asynchrone des donn&eacute;es</span></span></div></li><li class="sel_no anc_no type_l  dpt_0 practUc"><div class="lbl type_l" id="recuperation-asynchrone-donnee_1.html"><a href="recuperation-asynchrone-donnee_1.html" target="_self" class="item"><span>Exercice</span></a></div></li><li class="sel_no anc_no type_l  dpt_0 expUc"><div class="lbl type_l" id="persistance-donnees-ajax.html"><a href="persistance-donnees-ajax.html" target="_self" class="item"><span>Persistance des donn&eacute;es avec Ajax</span></a></div></li><li class="sel_no anc_no type_l  dpt_0 practUc"><div class="lbl type_l" id="persistance-donnees-ajax_1.html"><a href="persistance-donnees-ajax_1.html" target="_self" class="item"><span>Exercice</span></a></div></li><li class="sel_no anc_no type_l  dpt_0 expUc"><div class="lbl type_l" id="essentiel.html"><a href="essentiel.html" target="_self" class="item"><span>Essentiel</span></a></div></li><li class="sel_no anc_no type_b  type_b_c dpt_0 ueDiv"><div class="lbl type_b" id="auto-evaluation.html"><a href="auto-evaluation.html" target="_self" class="item"><span>Auto-&eacute;valuation</span></a></div></li></ul></nav><div id="tools" tabindex="-1"><hr class="hidden"><nav class="headingSelector" role="navigation"><ul class="mnu"><li class="anc_no home" data-position="uncle"><div class="lbl"><a href="module_ajax-axios-symfony.html" target="_self" class="item" type="index" title="Page d'accueil du module"><span>Accueil</span></a></div></li><li class="anc_yes module" data-position="parent"><div class="lbl"><span class="item"><span>Module</span></span></div></li></ul></nav></div><div id="navigation" tabindex="-1"><hr class="hidden"><a class="showMenu" role="button" href="#" target="_self" title="Menu" onclick="studiMgr.showHideMenu();return false;"><span>Menu</span></a><div id="fontSize"><a class="increase_font" href="#" title="Augmenter taille police" onclick="studiMgr.increaseFont();return false;"></a><a class="decrease_font" href="#" title="Diminuer taille police" onclick="studiMgr.decreaseFont();return false;"></a></div><nav class="pageTurner" role="navigation"><a rel="prev" href="module_ajax-axios-symfony.html" target="_self" class="btnNav prev" title="Pr&eacute;c&eacute;dent (Accueil)"><span>Pr&eacute;c&eacute;dent</span></a><a rel="next" href="recuperation-asynchrone-donnee_1.html" target="_self" class="btnNav next" title="Suivant (Exercice)"><span>Suivant</span></a></nav></div></div></main><footer id="footer" role="contentinfo" tabindex="-1"><hr class="hidden"><a id="linkSp" target="_blank" href="https://www.scenari.org" title="R&eacute;alis&eacute; avec Scenari (nouvelle fen&ecirc;tre)"><span><img alt="R&eacute;alis&eacute; avec Scenari (nouvelle fen&ecirc;tre)" src="../skin/img/tpl/scBtn.png"></span></a></footer></div>
  <script type="text/JavaScript" src="../skin/js/skin.js"></script>
  <script type="text/javascript">searchMgr.init({searchType:"listResults"});studiMgr.init();tplMgr.init();outMgr.init();scCodeMgr.init();scImgMgr.init();scMediaMgr.init("ide:content/chi:div/chi:section/des:.mediaPlayer",{processYoutubeUrls:true});</script>
 </body>
</html>
